---
title: "Logistic regression for Hbond analysis"
author: "Dizhou Wu"
date: "3/24/2022"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
suppressMessages(library(caret))
suppressMessages(library(rlang))
suppressMessages(library(ggplot2))
suppressMessages(library(ggmosaic))
suppressMessages(library(glmnet))
```

## TM56 TM456

```{r}
# Read data 
hbond_stride100_trajectory=read.csv("/deac/salsburyGrp/wud18/md/TM/hbond/hbond_stride100_trajectory_selected.csv")
```

```{r}
# Replace headers
Colnames1 <- c("LEU11-HIS152","ARG12-GLU16","ARG12-ASP22","ARG12-MET47","GLU16-GLU16","LYS17-ARG12","SER19-PHE15","LEU20-PHE15","ASP22-GLU25","THR24-ASP22","GLU25-ASP22","ARG26-GLU30","LEU28-GLU25","GLU30-ARG26","SER31-GLU27","SER31-LEU28","TYR32-LYS248","MET53-ARG98","ARG56-SER58","LYS57-ASP94","LYS57-ASN93","SER58-GLU359","GLN60-LYS57","ALA66-VAL52","ILE69-TRP73","SER70-TRP73","ARG72-ASP71","ARG72-LEU141","ARG72-GLU118","TRP73-SER70","ALA77-THR76","ALA78-ASP135","LEU82-ALA78","ASP87-PRO84","LYS88-TYR83","PHE90-LEU81","THR91-ASP94","GLU92-GLU92","ARG98-ARG106","THR105-ASP368","ARG106-ASP368","TYR107-ASP367","ARG109-TYR107","ARG109-ASP374","ARG109-THR373","ASN110-GLU379","ILE111-GLU108","GLU112-GLU108","ILE114-ASN380","LYS119-GLU92","ILE120-GLU92","ASN127-ASP133","LYS140-PHE293","LYS140-GLU118","LYS143-ASP412","VAL145-ASP71","SER148-ILE151","TYR150-SER148","ARG159-GLU160","THR161-ASP158","ALA163-ARG159","SER164-GLU160","LEU165-THR161","LEU166-ALA162","GLN167-SER164","GLY169-ILE203","LYS171-SER31","LYS171-GLU27","GLY172-LEU201","ARG173-ASN200","ARG173-ASP22","ARG173-THR24","VAL174-VAL199","TRP177-HIS102","LYS181-GLU39","LEU196-HIS102","GLN197-GLY176","GLN197-ASP42","GLN197-VAL195","ASN200-THR24","ASN200-GLU27","GLU205-GLU205","ARG206-MET221","ARG206-THR218","VAL208-GLU205","CYS209-GLU205","LYS210-ARG206","ASP211-PRO207","SER212-VAL208","THR213-GLU265","ARG216-GLU130","THR218-ASP133","TYR226-ASN200","LYS227-GLU205","ASP229-ASP229","GLU230-LYS227","LYS232-GLU27","ARG233-ASP270","ALA236-ASP235","ASP240-CYS237","GLY243-ASP240","MET247-TYR256","LYS248-GLU16","LYS248-GLU25","PHE251-SER249","ARG254-ASP8","ARG254-CYS9","TRP255-GLU16","GLN257-GLY259","MET258-PHE245","ILE260-THR277","VAL261-GLY243","CYS267-GLU182","ASP268-ASP235","LYS272-ARG269","LYS272-GLU265","LYS272-SER212","PHE275-TRP263","HIS278-MET258","VAL279-MET258","LYS283-GLN287","ILE286-LEU282","GLN287-LYS283","LYS288-LYS284","VAL289-TRP285","ILE290-ILE286","ASP291-GLN287","PHE293-VAL289","ALA348-PHE370","ASP351-SER357","ASN353-ASP351","GLU359-ASP349","TYR364-PRO361","ILE371-ASP367","ASP374-THR344","ILE375-GLY363","GLU379-ASP376","ASN380-ASP376","ASN380-ILE114","ASN380-GLY381","GLY381-GLU377","VAL387-ILE398","LEU391-THR394","GLY393-ASP374","PHE395-THR394")
Colnames2 <- c("CYS399-ALA406","ALA406-CYS399","PHE15-ARG12","LYS18-PHE15","SER41-VAL198","MET47-GLU44","GLN51-SER48","LYS57-GLU362","LEU81-ALA78","ASP94-THR91","VAL97-SER115","ASN131-ARG216","ILE151-SER148","HIS152-PRO49","HIS152-SER148","VAL154-LEU68","ALA162-ASP158","GLN167-LEU165","GLY176-GLN197","VAL199-VAL174","ALA224-GLY274","ASP235-VAL38","ASN252-TYR256","ARG254-ASN252","THR277-ASP135","ARG281-HIS278","LEU282-VAL279","LYS283-PHE280","LYS283-PRO157","TRP285-LEU282","GLY369-ASP368","ASP376-TYR107","PHE383-GLY381","ASP402-ASP402","TYR32-LEU28","ARG36-ASP34","SER48-THR175","GLU61-PRO59","ASP71-SER70","ARG106-ASP367","ILE111-ARG109","LYS143-GLY382","HIS152-ILE151","GLN167-ALA163","ASN179-GLU238","SER212-CYS209","LYS288-ASP291","GLY294-ILE290","ASP349-GLU359","THR354-ASP351","HIS408-ASP412","GLN60-TYR364","ARG72-GLU295","HIS123-ILE136","ASN220-THR218","MET221-THR218","ASP229-LYS227","ASN253-SER249","GLY259-PHE245","LEU29-GLU25","TYR32-LYS171","CYS155-TRP255","GLN197-LEU196","ARG206-ASP219","GLY239-SER241","MET258-TYR256","ASN390-ASP376","PHE2-THR1","LYS18-PRO13","ARG26-GLU21","TYR32-LEU29","ILE33-LEU29","ASP71-ASP71","LYS113-GLU379","ILE136-ARG134","LYS142-GLU118","GLN192-ASN179","LYS227-ASP229","GLY274-ALA224","THR277-ILE260","ARG36-GLY35","ARG36-GLU30","GLN51-VAL52","LYS88-TRP86","ARG104-GLU61","TYR126-HIS123","ARG214-ASP211","SER262-PHE275","TRP50-SER48","TYR170-GLN167","LEU28-THR24","ILE215-THR213","LYS227-GLU230","LYS248-TYR32","ALA404-PRO401","TRP86-TYR83","ARG129-ASN127","LYS140-GLU295","THR1-GLU6","GLU160-GLU160","SER19-GLU16","GLY243-SER241","CYS9-ASP8","ARG109-ASP376","LYS248-ASN253","ASN252-SER249","LEU405-PRO401","ASP412-THR411","LYS119-GLU118","GLU238-CYS237","LYS283-LEU156","SER241-HIS79","PHE370-ASP367","THR1-ASP71","ARG26-ASP22","ASP133-ASN127","LYS210-ILE217","LYS210-ASP219","ILE217-ILE215","LYS17-ASP149","ARG281-ASP219","GLN257-GLN257","GLU16-ARG12","LYS18-LEU14","ASP158-THR161","SER48-MET47","ASP219-ASP219","LYS283-VAL279","SER194-THR105","SER194-SER103","SER241-SER262","ARG159-ASP158","GLU27-LYS23","LYS283-ASP158","ARG214-GLU265","GLY46-HIS102","TRP86-GLU238","ARG106-SER103","ARG173-GLU25","ARG206-ILE217","LEU62-GLU61","ASN220-HIS278","ARG104-TRP177","ASN131-ARG129","LEU180-GLN192","THR218-LEU132","ARG109-ASP367","VAL195-SER194","TRP128-ASN127","THR105-SER194","SER212-GLY271","HIS123-PRO124","TRP263-SER262","LEU132-ARG216","THR213-CYS209","LEU132-ASN131","LYS232-GLU39","ILE33-TYR170","GLY400-ALA406","LYS23-GLU21","GLY234-ASP268","SER357-GLU61","LYS23-GLU44","TYR273-SER212","ALA406-ASP402","LYS17-PRO13")
Colnames <- c(Colnames1,Colnames2)
colnames(hbond_stride100_trajectory) <- Colnames 
```

```{r}
# Add column TM4
a=rep(1, 8000)
b=rep(0, 8000)
c <- c(a,b)
hbond_stride100_trajectory$TM4 <- c
levels(as.factor(hbond_stride100_trajectory$TM4))
```

```{r}
# Train the logistic regression model
m2 <- glm(formula = TM4 ~ ., data=hbond_stride100_trajectory, family='binomial')
```

```{r}
# Save coef
coef <- data.frame(m2$coefficients)
write.csv(coef, "/deac/salsburyGrp/wud18/md/TM/logistic_regression_Hbond/logistic_regression.csv", row.names = TRUE)
```

```{r}
# Coef in order
coef_sorted <- sort(m2$coefficients, decreasing = TRUE)
knitr::kable(c(coef_sorted[1:11],coef_sorted[303:312]))
```

```{r}
# Elastic net
tuningGrid <- data.frame("alpha" = c(0), "lambda"= c(0.0034375))
set.seed(100)
TM_final_model = train(
  as.factor(TM4) ~ ., data = hbond_stride100_trajectory,
  method = "glmnet",
  lambda=0.0034375,
  tuneGrid = tuningGrid,
  trControl = trainControl(method = "cv", number = 10)
)
TM_final_model
```

```{r}
# Parameters
Beta1 <- m2$coefficients
Beta2 <- as.numeric(coef(TM_final_model$finalModel))
```

```{r}
# Compare them
Comparison <- data.frame("LogisticRegression" = Beta1, "Elastic_net" = Beta2)
rownames(Comparison) <- c('(Intercept)',Colnames)
tmp1 <- Comparison[order(-Comparison$Elastic_net)[1:15],]
tmp2 <- Comparison[order(-Comparison$Elastic_net)[303:312],]
Betas=rbind(tmp1,tmp2)
knitr::kable(Betas)
```

```{r}
# Elastic net (top 9)
Top9_TM <- c("LEU132-ARG216","ARG72-LEU141","THR1-ASP71","PHE275-TRP263","HIS123-PRO124","ALA404-PRO401","ASP133-ASN127","ARG104-GLU61","SER241-SER262")
tuningGrid <- data.frame("alpha" = c(0), "lambda"= c(0.0034375))
set.seed(100)
TM_final_model_top9 = train(
  as.factor(TM4) ~ ., data = hbond_stride100_trajectory[ , names(hbond_stride100_trajectory) %in% 
    c(Top9_TM,"TM4")],
  method = "glmnet",
  lambda=0.0034375,
  tuneGrid = tuningGrid,
  trControl = trainControl(method = "cv", number = 10)
)
```

```{r}
TM_final_model_top9
```

```{r}
# Elastic net (top 10)
Top10_TM <- c("LEU132-ARG216","ARG72-LEU141","THR1-ASP71","PHE275-TRP263","HIS123-PRO124","ALA404-PRO401","ASP133-ASN127","ARG104-GLU61","SER241-SER262","ARG12-ASP22")
tuningGrid <- data.frame("alpha" = c(0), "lambda"= c(0.0034375))
set.seed(100)
TM_final_model_top10 = train(
  as.factor(TM4) ~ ., data = hbond_stride100_trajectory[ , names(hbond_stride100_trajectory) %in% 
    c(Top10_TM,"TM4")],
  method = "glmnet",
  lambda=0.0034375,
  tuneGrid = tuningGrid,
  trControl = trainControl(method = "cv", number = 10)
)
```

```{r}
TM_final_model_top10
```

```{r}
# Elastic net (top 11)
Top11_TM <- c("LEU132-ARG216","ARG72-LEU141","THR1-ASP71","PHE275-TRP263","HIS123-PRO124","ALA404-PRO401","ASP133-ASN127","ARG104-GLU61","SER241-SER262","ARG12-ASP22","TRP86-GLU238")
tuningGrid <- data.frame("alpha" = c(0), "lambda"= c(0.0034375))
set.seed(100)
TM_final_model_top11 = train(
  as.factor(TM4) ~ ., data = hbond_stride100_trajectory[ , names(hbond_stride100_trajectory) %in% 
    c(Top11_TM,"TM4")],
  method = "glmnet",
  lambda=0.0034375,
  tuneGrid = tuningGrid,
  trControl = trainControl(method = "cv", number = 10)
)
```

```{r}
TM_final_model_top11
```

## Thrombin TM56

```{r}
## Thrombin TM56
# Read data
hbond_stride100_trajectory=read.csv("/deac/salsburyGrp/wud18/md/TM/hbond/hbond_stride100_thrombin_TM56_trajectory_selected.csv")
```

```{r}
# Replace headers
Colnames1 <- c("ARG12-GLU16","ARG12-ASP22","ARG12-MET47","GLU16-GLU16","LYS17-ARG12","LYS18-PHE15","SER19-GLU16","LEU20-PHE15","ASP22-GLU25","LYS23-GLU44","THR24-ASP22","GLU25-ASP22","ARG26-GLU30","LEU28-GLU25","GLU30-ARG26","SER31-LEU28","TYR32-LYS248","SER41-VAL198","MET47-GLU44","SER48-THR175","GLN51-SER48","MET53-ARG98","LEU54-CYS64","LYS57-ASP94","LYS57-ASN93","GLN60-LYS57","ALA66-VAL52","ARG72-ASP71","ARG72-LEU141","ARG72-GLU118","THR76-ALA137","ALA77-THR76","ALA78-ASP135","LEU81-ALA78","LEU82-ALA78","ASP87-PRO84","PHE90-LEU81","THR91-ASP94","GLU92-GLU92","ASP94-THR91","ARG98-MET53","ARG104-PRO193","ILE111-GLU108","ILE111-ARG109","GLU112-GLU108","LYS119-GLU92","ASN127-ASP133","ASP133-ASN127","LYS140-PHE293","LYS140-GLU118","VAL145-ASP71","SER148-ILE151","ARG159-GLU160","THR161-ASP158","ALA162-ASP158","SER164-GLU160","LEU165-THR161","LEU166-ALA162","GLN167-LEU165","GLN167-SER164","GLY169-ILE203","LYS171-SER31","LYS171-GLU27","ARG173-ASP22","ARG173-THR24","VAL174-VAL199","GLY176-GLN197","TRP177-HIS102","ASN179-GLU238","LYS181-GLU39","THR183-GLU182","LEU196-HIS102","GLN197-GLY176","GLN197-ASP42","GLN197-LEU196","ASN200-THR24","ASN200-GLU27","VAL204-CYS223","GLU205-GLU205","ARG206-ASP219","ARG206-MET221","ARG206-THR218","CYS209-GLU205","ASP211-PRO207","SER212-VAL208","SER212-CYS209","THR213-GLU265","THR218-ASP133","ALA224-GLY274","TYR226-ASN200","LYS227-GLU230","LYS227-GLU205","GLU230-LYS227","LYS232-GLU27","ARG233-ASP270","ALA236-ASP235","GLU238-CYS237","ASP240-CYS237","GLY243-ASP240","MET247-TYR256","LYS248-ASN253","LYS248-GLU16","LYS248-GLU25","ASN252-TYR256","ASN253-SER249","ARG254-ASN252","ARG254-ASP8","ARG254-CYS9","GLN257-GLY259","MET258-PHE245","GLY259-PHE245","VAL261-GLY243","SER262-PHE275","ASP268-ASP235","LYS272-GLU265","LYS272-SER212","GLY274-ALA224","PHE275-TRP263","THR277-ILE260","THR277-ASP135","VAL279-MET258","LEU282-VAL279","LYS283-GLN287","LYS283-PRO157","ILE286-LEU282","GLN287-LYS283","VAL289-TRP285","ASP291-GLN287")
Colnames2 <- c("PHE293-VAL289","GLY294-ILE290","THR1-ASP291","ILE37-ASN179","TRP50-SER48","ARG56-SER58","ILE69-TRP73","SER70-TRP73","ASP71-SER70","ASP71-ASP71","ARG72-GLU295","LYS88-TYR83","VAL97-SER115","HIS123-ILE136","ASN131-ARG216","TYR150-SER148","ILE151-SER148","VAL154-LEU68","GLU160-GLU160","ALA163-ARG159","VAL199-VAL174","LYS210-ARG206","LYS210-ASP219","ARG216-GLU130","ASN220-THR218","ASP229-ASP229","ASP235-VAL38","SER241-HIS79","TRP255-GLU16","CYS267-GLU182","LYS288-LYS284","ILE290-ILE286","LEU11-HIS152","PHE15-ARG12","TYR32-LYS171","SER48-MET47","GLN51-VAL52","TRP73-SER70","SER115-MET116","TYR126-HIS123","ILE136-ARG134","LYS140-GLU295","HIS152-PRO49","CYS155-TRP255","GLN167-ALA163","ARG173-ASN200","GLN197-VAL195","LYS210-ILE217","ARG281-HIS278","TRP285-LEU282","LEU29-GLU25","THR105-SER194","MET221-THR218","GLY239-SER241","PHE251-SER249","ASN252-SER249","ILE260-THR277","GLU16-ARG12","LYS17-PRO13","LYS18-LEU14","LEU28-THR24","TYR32-LEU29","ARG129-ASN127","TYR170-GLN167","GLN192-ASN179","SER194-SER103","VAL208-GLU205","LYS272-ARG269","GLY35-ASP34","SER58-GLN60","ARG106-SER103","LYS283-VAL279","LYS283-LEU156","LYS119-GLU118","SER19-PHE15","SER194-THR105","GLY234-ASP268","ILE33-TYR170","ARG72-GLY294","ASN187-THR185","ARG109-TYR107","LYS142-GLU118","LEU180-GLN192","LYS288-ASP291","GLU61-PRO59","PHE2-THR1","CYS9-ASP8","MET258-TYR256","TRP86-TYR83","LYS88-TRP86","ARG159-ASP158","TYR32-LEU28","LYS283-ASP158","ILE33-LEU29","ARG36-GLY35","ASP158-THR161","LEU165-ALA162","ILE217-ILE215","GLY243-SER241","ARG36-ASP34","ARG104-TRP177","TRP128-ASN127","THR183-GLU238","VAL195-SER194","ARG26-GLU21","SER31-GLU27","ARG214-GLU265","LYS248-TYR32","ASN220-HIS278","ILE215-THR213","ASP229-LYS227","ILE120-GLU92","TRP86-GLU238","GLU61-ARG56","HIS152-ILE151","ARG206-ILE217","LEU62-GLU61","CYS64-LEU54","ARG104-GLU61","ASN131-ARG129","HIS152-SER148","THR1-GLU6","GLN257-GLN257","LYS283-GLU6","TRP263-SER262","ARG36-GLU30","LYS227-ASP229","ARG26-ASP22","ARG56-LYS57","LYS17-ASP149","HIS278-MET258","ARG281-ASP219","ASP219-ASP219","LEU132-ASN131","LYS23-GLU21","SER212-GLY271","LYS140-LEU141","LYS232-GLU39","THR213-CYS209","ARG134-ASP219","TYR273-SER212","GLY46-HIS102","GLU27-LYS23","ARG173-GLU25","THR277-SER262","ARG233-GLU39","HIS123-PRO124")
Colnames <- c(Colnames1,Colnames2)
colnames(hbond_stride100_trajectory) <- Colnames 
```

```{r}
# Add column TM4
a=rep(0, 8000)
b=rep(1, 8000)
d <- c(a,b)
hbond_stride100_trajectory$TM4 <- d
levels(as.factor(hbond_stride100_trajectory$TM4))
```

```{r}
# Train the logistic regression model
m2 <- glm(formula = TM4 ~ ., data=hbond_stride100_trajectory, family='binomial')
```

```{r}
# Elastic net
tuningGrid <- data.frame("alpha" = c(0.875), "lambda"= c(0.0009375))
set.seed(100)
thrombin_TM56_final_model = train(
  as.factor(TM4) ~ ., data = hbond_stride100_trajectory,
  method = "glmnet",
  lambda=0.0009375,
  tuneGrid = tuningGrid,
  trControl = trainControl(method = "cv", number = 10)
)
thrombin_TM56_final_model
```

```{r}
# Parameters
Beta1 <- m2$coefficients
Beta2 <- as.numeric(coef(thrombin_TM56_final_model$finalModel))
```

```{r}
# Compare them
Comparison <- data.frame("LogisticRegression" = Beta1, "Elastic_net" = Beta2)
rownames(Comparison) <- c('(Intercept)',Colnames)
tmp1 <- Comparison[order(-Comparison$Elastic_net)[1:11],]
tmp2 <- Comparison[order(-Comparison$Elastic_net)[267:276],]
Betas=rbind(tmp1,tmp2)
knitr::kable(Betas)
```

```{r}
# Elastic net (top 11)
Top11_thrombin_TM56 <- c("ARG56-LYS57","SER58-GLN60","TYR32-LYS248","HIS123-PRO124","GLU112-GLU108","TYR32-LYS171","PHE275-TRP263","ARG233-GLU39","THR213-CYS209","ARG173-ASP22","GLN60-LYS57")
tuningGrid <- data.frame("alpha" = c(0.875), "lambda"= c(0.0009375))
set.seed(100)
thrombin_TM56_final_model_top11 = train(
  as.factor(TM4) ~ ., data = hbond_stride100_trajectory[ , names(hbond_stride100_trajectory) %in% 
    c(Top11_thrombin_TM56,"TM4")],
  method = "glmnet",
  lambda=0.0009375,
  tuneGrid = tuningGrid,
  trControl = trainControl(method = "cv", number = 10)
)
thrombin_TM56_final_model_top11
```

## Thrombin TM456

```{r}
## Thrombin TM456
# Read data
hbond_stride100_trajectory=read.csv("/deac/salsburyGrp/wud18/md/TM/hbond/hbond_stride100_thrombin_TM456_trajectory_selected.csv")
```

```{r}
# Replace headers
Colnames1 <- c("THR1-GLU295","ARG12-GLU16","ARG12-ASP22","ARG12-MET47","GLU16-GLU16","LYS17-ARG12","LYS18-PHE15","SER19-GLU16","LEU20-PHE15","ASP22-GLU25","LYS23-GLU44","THR24-ASP22","GLU25-ASP22","ARG26-GLU30","LEU28-GLU25","GLU30-ARG26","SER31-LEU28","TYR32-LYS248","SER41-VAL198","MET47-GLU44","SER48-THR175","GLN51-SER48","MET53-ARG98","LEU54-CYS64","LYS57-ASP94","LYS57-ASN93","GLN60-LYS57","ALA66-VAL52","ARG72-ASP71","ARG72-LEU141","ARG72-GLU118","THR76-ALA137","ALA77-THR76","ALA78-ASP135","LEU81-ALA78","LEU82-ALA78","TYR83-LYS88","ASP87-PRO84","PHE90-LEU81","THR91-ASP94","GLU92-GLU92","ASP94-THR91","ARG98-MET53","ILE99-LYS113","ILE111-GLU108","ILE111-ARG109","GLU112-GLU108","LYS119-GLU92","TYR126-LEU82","ASN127-ASP133","ASP133-ASN127","LYS140-PHE293","LYS140-GLU118","VAL145-ASP71","SER148-ILE151","ARG159-GLU160","THR161-ASP158","ALA162-ASP158","SER164-GLU160","LEU165-THR161","LEU166-ALA162","GLN167-LEU165","GLN167-SER164","GLY169-ILE203","TYR170-ASP34","LYS171-SER31","LYS171-GLU27","ARG173-ASP22","ARG173-THR24","VAL174-VAL199","GLY176-GLN197","TRP177-HIS102","ASN179-GLU238","LYS181-GLU39","LEU196-HIS102","GLN197-GLY176","GLN197-ASP42","GLN197-LEU196","ASN200-THR24","ASN200-GLU27","GLU205-GLU205","ARG206-ASP219","ARG206-MET221","ARG206-THR218","CYS209-GLU205","ASP211-PRO207","SER212-VAL208","SER212-CYS209","THR213-GLU265","THR218-ASP133","ALA224-GLY274","TYR226-ASN200","LYS227-GLU230","LYS227-GLU205","GLU230-LYS227","LYS232-GLU27","ARG233-ASP270","ALA236-ASP235","GLU238-CYS237","ASP240-CYS237","GLY243-ASP240","MET247-TYR256","LYS248-ASN253","LYS248-GLU16","LYS248-GLU25","ASN252-TYR256","ASN253-SER249","ARG254-ASN252","ARG254-ASP8","ARG254-CYS9","GLN257-GLY259","MET258-PHE245","GLY259-PHE245","VAL261-GLY243","SER262-PHE275","ASP268-ASP235","ARG269-GLU182","LYS272-GLU265","LYS272-SER212","GLY274-ALA224","PHE275-TRP263","THR277-ILE260","THR277-ASP135","VAL279-MET258","LEU282-VAL279")
Colnames2 <- c("LYS283-GLN287","LYS283-PRO157","ILE286-LEU282","GLN287-LYS283","VAL289-TRP285","ASP291-GLN287","GLN292-LYS288","PHE293-VAL289","GLY294-ILE290","ILE37-ASN179","TRP50-SER48","ARG56-SER58","ILE69-TRP73","SER70-TRP73","ASP71-SER70","ASP71-ASP71","ARG72-GLU295","ARG72-LYS142","LYS88-TYR83","VAL97-SER115","HIS123-ILE136","ASN131-ARG216","TYR150-SER148","ILE151-SER148","VAL154-LEU68","GLU160-GLU160","ALA163-ARG159","VAL199-VAL174","LYS210-ARG206","LYS210-ASP219","ARG216-GLU130","ASN220-THR218","ASP229-ASP229","ASP235-VAL38","SER241-HIS79","TRP255-GLU16","CYS267-GLU182","LYS288-LYS284","ILE290-ILE286","LEU11-HIS152","PHE15-ARG12","TYR32-LYS171","SER48-MET47","GLN51-VAL52","TRP73-SER70","SER115-MET116","TYR126-HIS123","ILE136-ARG134","LYS140-GLU295","HIS152-PRO49","CYS155-TRP255","GLN167-ALA163","ARG173-ASN200","GLN197-VAL195","LYS210-ILE217","ARG281-HIS278","TRP285-LEU282","LEU29-GLU25","THR105-SER194","MET221-THR218","GLY239-SER241","PHE251-SER249","ASN252-SER249","ILE260-THR277","GLU16-ARG12","LYS17-PRO13","LYS18-LEU14","LEU28-THR24","TYR32-LEU29","ARG129-ASN127","TYR170-GLN167","GLN192-ASN179","SER194-SER103","VAL208-GLU205","LYS272-ARG269","SER58-GLN60","ARG106-SER103","LYS283-VAL279","LYS283-LEU156","LYS119-GLU118","SER19-PHE15","SER194-THR105","SER241-SER262","GLY234-ASP268","ARG72-GLY294","ASN187-THR185","THR218-ASN131","ARG109-TYR107","LYS142-GLU118","LEU180-GLN192","LYS288-ASP291","GLU61-PRO59","PHE2-THR1","CYS9-ASP8","MET258-TYR256","TRP86-TYR83","LYS88-TRP86","ARG159-ASP158","TYR32-LEU28","LYS283-ASP158","ILE33-LEU29","ARG36-GLY35","ASP158-THR161","LEU165-ALA162","ILE217-ILE215","GLY243-SER241","ARG36-ASP34","ARG104-TRP177","TRP128-ASN127","THR183-GLU238","VAL195-SER194","ARG26-GLU21","SER31-GLU27","ARG214-GLU265","LYS248-TYR32","ASN220-HIS278","ILE215-THR213","ILE120-GLU92","GLU61-ARG56","HIS152-ILE151","ARG206-ILE217","LEU62-GLU61","CYS64-LEU54","ARG104-GLU61","ASN131-ARG129","HIS152-SER148","THR1-GLU6","GLN257-GLN257","TRP263-SER262","ARG36-GLU30","LYS227-ASP229","ARG26-ASP22","ARG56-LYS57","ARG56-PRO59","LYS17-ASP149","HIS278-MET258","ARG216-ASP211","ARG281-ASP219","ASP219-ASP219","LEU132-ASN131","LYS23-GLU21","THR218-LEU132","SER212-GLY271","LYS232-GLU39","TYR273-SER212","GLY46-HIS102","GLY35-GLU30","ASP34-GLU30","GLU27-LYS23","ARG173-GLU25","THR1-ASP71","ARG233-GLU39","LEU132-ARG216","HIS123-PRO124")
Colnames <- c(Colnames1,Colnames2)
colnames(hbond_stride100_trajectory) <- Colnames 
```

```{r}
# Add column TM4
a=rep(0, 8000)
b=rep(1, 8000)
d <- c(a,b)
hbond_stride100_trajectory$TM4 <- d
levels(as.factor(hbond_stride100_trajectory$TM4))
```

```{r}
# Train the logistic regression model
m2 <- glm(formula = TM4 ~ ., data=hbond_stride100_trajectory, family='binomial')
```

```{r}
# Elastic net
tuningGrid <- data.frame("alpha" = c(0.1875), "lambda"= c(0.00171875))
set.seed(100)
thrombin_TM456_final_model = train(
  as.factor(TM4) ~ ., data = hbond_stride100_trajectory,
  method = "glmnet",
  lambda=0.00171875,
  tuneGrid = tuningGrid,
  trControl = trainControl(method = "cv", number = 10)
)
thrombin_TM456_final_model
```

```{r}
# Parameters
Beta1 <- m2$coefficients
Beta2 <- as.numeric(coef(thrombin_TM456_final_model$finalModel))
```

```{r}
# Compare them
Comparison <- data.frame("LogisticRegression" = Beta1, "Elastic_net" = Beta2)
rownames(Comparison) <- c('(Intercept)',Colnames)
tmp1 <- Comparison[order(-Comparison$Elastic_net)[1:11],]
tmp2 <- Comparison[order(-Comparison$Elastic_net)[267:276],]
Betas=rbind(tmp1,tmp2)
knitr::kable(Betas)
```

```{r}
# Elastic net (top 11)
Top11_thrombin_TM456 <- c("LEU132-ARG216","TYR32-LYS248","GLU112-GLU108","ARG56-LYS57","GLN60-LYS57","GLU205-GLU205","TYR32-LYS171","SER31-LEU28","ARG173-ASP22","TYR83-LYS88","TRP263-SER262")
tuningGrid <- data.frame("alpha" = c(0.875), "lambda"= c(0.0009375))
set.seed(100)
thrombin_TM456_final_model_top11 = train(
  as.factor(TM4) ~ ., data = hbond_stride100_trajectory[ , names(hbond_stride100_trajectory) %in% 
    c(Top11_thrombin_TM456,"TM4")],
  method = "glmnet",
  lambda=0.0009375,
  tuneGrid = tuningGrid,
  trControl = trainControl(method = "cv", number = 10)
)
thrombin_TM456_final_model_top11
```

## Thrombin TM56 TM456

```{r}
## Thrombin TM56 TM456
# Read data
hbond_stride100_trajectory=read.csv("/deac/salsburyGrp/wud18/md/TM/hbond/hbond_stride100_thrombin_TM56_TM456_trajectory_selected.csv")
```

```{r}
# Replace headers
Colnames1 <- c("THR1-GLU295","ARG12-GLU16","ARG12-ASP22","ARG12-MET47","GLU16-GLU16","LYS17-ARG12","LYS17-ASP8","LYS18-PHE15","SER19-GLU16","LEU20-PHE15","ASP22-GLU25","LYS23-GLU44","THR24-ASP22","GLU25-ASP22","ARG26-GLU30","LEU28-GLU25","GLU30-ARG26","SER31-LEU28","TYR32-LYS248","SER41-VAL198","ALA43-LEU196","MET47-GLU44","SER48-THR175","GLN51-SER48","VAL52-ALA66","MET53-ARG98","LEU54-CYS64","ARG56-GLU61","LYS57-ASP94","LYS57-ASN93","GLN60-LYS57","ALA66-VAL52","ARG72-ASP71","ARG72-LEU141","ARG72-GLU118","VAL74-MET139","THR76-ALA137","THR76-GLY65","ALA77-THR76","ALA78-ASP135","LEU81-ALA78","LEU82-ALA78","TYR83-LYS88","ASP87-PRO84","PHE90-LEU81","THR91-ASP94","GLU92-GLU92","ASP94-THR91","ARG98-MET53","ILE99-LYS113","ARG104-PRO193","GLU108-GLU112","ILE111-GLU108","ILE111-ARG109","GLU112-GLU108","LYS119-GLU92","TYR126-LEU82","ASN127-ASP133","ASP133-ASN127","LYS140-PHE293","LYS140-GLU118","VAL145-ASP71","SER148-ILE151","ARG159-GLU160","THR161-ASP158","ALA162-ASP158","SER164-GLU160","LEU165-THR161","LEU166-ALA162","GLN167-LEU165","GLN167-SER164","GLY169-ILE203","TYR170-ASP34","LYS171-SER31","LYS171-GLU27","GLY172-LEU201","ARG173-ASP22","ARG173-THR24","VAL174-VAL199","GLY176-GLN197","TRP177-HIS102","ASN179-GLU238","LYS181-GLU39","THR183-GLU182","LEU196-HIS102","GLN197-GLY176","GLN197-ASP42","GLN197-LEU196","ASN200-THR24","ASN200-GLU27","ILE203-TYR170","VAL204-CYS223","GLU205-GLU205","ARG206-ASP219","ARG206-MET221","ARG206-THR218","CYS209-GLU205","ASP211-PRO207","SER212-VAL208","SER212-CYS209","THR213-GLU265","ARG216-ASN131","THR218-ASP133","ALA224-GLY274","TYR226-ASN200","LYS227-GLU230","LYS227-GLU205","GLU230-LYS227","LYS232-GLU27","ARG233-ASP268","ARG233-ASP270","ALA236-ASP235","GLU238-CYS237","ASP240-CYS237","GLY243-ASP240","PHE245-GLY259","VAL246-ARG173","MET247-TYR256","LYS248-ASN253","LYS248-GLU16","LYS248-GLU25","ASN252-ASN252","ASN252-TYR256","ASN253-SER249","ARG254-ASN252","ARG254-ASP8","ARG254-CYS9","TRP255-GLY10","GLN257-GLY259","MET258-PHE245","GLY259-PHE245","VAL261-GLY243","SER262-PHE275","ASP268-ASP235","ARG269-GLU182","LYS272-GLU265","LYS272-SER212","GLY274-ALA224","PHE275-TRP263","THR277-ILE260","THR277-ASP135","HIS278-ASN220","VAL279-MET258","LEU282-VAL279","LYS283-GLN287","LYS283-PRO157","ILE286-LEU282","GLN287-LYS283","VAL289-TRP285","ASP291-GLN287","GLN292-LYS288","PHE293-VAL289","GLY294-ILE290","THR1-ASP291","ILE37-ASN179","TRP50-SER48","ARG56-SER58","LEU63-LEU54")
Colnames2 <- c("ILE69-TRP73","SER70-TRP73","ASP71-SER70","ASP71-ASP71","ARG72-GLU295","ARG72-LYS142","LYS88-TYR83","VAL97-SER115","ARG104-GLN192","HIS123-ILE136","ASN131-ARG216","TYR150-SER148","ILE151-SER148","VAL154-LEU68","GLU160-GLU160","ALA163-ARG159","SER164-THR161","VAL199-VAL174","LYS210-ARG206","LYS210-ASP219","ARG216-GLU130","ASN220-THR218","ASP229-ASP229","ASP235-VAL38","SER241-HIS79","TRP255-GLU16","CYS267-GLU182","LYS288-LYS284","ILE290-ILE286","LEU11-HIS152","PHE15-ARG12","LYS18-PRO13","TYR32-LYS171","SER48-MET47","GLN51-VAL52","TRP73-SER70","SER115-MET116","TYR126-HIS123","ILE136-ARG134","LYS140-GLU295","HIS152-PRO49","CYS155-TRP255","GLN167-ALA163","ARG173-ASN200","GLN197-VAL195","LYS210-ILE217","ARG214-ASP211","ARG281-HIS278","TRP285-LEU282","LEU29-GLU25","THR105-SER194","MET221-THR218","GLY239-SER241","PHE251-SER249","ASN252-SER249","ILE260-THR277","GLU16-ARG12","LYS17-PRO13","LYS18-LEU14","LEU28-THR24","TYR32-LEU29","ARG129-ASN127","TYR170-GLN167","GLN192-ASN179","SER194-SER103","VAL208-GLU205","LYS272-ARG269","LYS283-PHE280","GLY35-ASP34","SER58-GLN60","ARG106-SER103","LYS283-VAL279","LYS283-LEU156","LYS119-GLU118","SER19-PHE15","SER194-THR105","SER241-SER262","GLY234-ASP268","ILE33-TYR170","ARG72-GLY294","ASN187-THR185","THR218-ASN131","ILE286-LYS283","ARG109-TYR107","LYS142-GLU118","LEU180-GLN192","LYS288-ASP291","ILE33-GLU30","GLU61-PRO59","PHE2-THR1","CYS9-ASP8","MET258-TYR256","TRP86-TYR83","LYS88-TRP86","ARG159-ASP158","TYR32-LEU28","LYS283-ASP158","SER19-SER19","ILE33-LEU29","ARG36-GLY35","ASP158-THR161","LYS119-LYS140","LEU165-ALA162","ILE217-ILE215","LYS232-GLU230","GLY243-SER241","ARG36-ASP34","ARG104-TRP177","TRP128-ASN127","THR183-GLU238","LYS210-ASP211","VAL195-SER194","ARG26-GLU21","SER31-GLU27","ARG214-GLU265","LYS248-TYR32","ASN220-HIS278","ASP211-VAL208","ILE215-THR213","GLU27-THR24","ASP229-LYS227","ILE120-GLU92","TRP86-GLU238","ARG98-ARG106","GLU61-ARG56","TYR170-ALA168","HIS152-ILE151","ARG206-ILE217","LEU62-GLU61","CYS64-LEU54","ARG104-GLU61","ASN131-ARG129","HIS152-SER148","LYS113-ASN110","ARG173-MET47","THR1-GLU6","GLN257-GLN257","LYS283-GLU6","TRP263-SER262","ARG36-GLU30","LYS227-ASP229","SER48-SER48","ARG26-ASP22","ARG56-LYS57","ARG56-PRO59","LYS17-ASP149","HIS278-MET258","ARG216-ASP211","ARG281-ASP219","ASP219-ASP219","LEU132-ASN131","LYS23-GLU21","THR218-LEU132","SER212-GLY271","LYS140-LEU141","LYS181-LYS190","GLY231-GLU230","LYS232-GLU39","THR213-CYS209","ARG134-ASP219","TYR273-SER212","GLY46-HIS102","ALA7-GLY3","GLY35-GLU30","ASP34-GLU30","GLU27-LYS23","ARG173-GLU25","THR1-ASP71","THR277-SER262","ARG233-GLU39","LEU132-ARG216","HIS123-PRO124")
Colnames <- c(Colnames1,Colnames2)
colnames(hbond_stride100_trajectory) <- Colnames 
```

```{r}
# Add column TM4
a=rep(0, 8000)
b=rep(1, 8000)
c=rep(2, 8000)
d <- c(a,b,c)
hbond_stride100_trajectory$TM4 <- d
levels(as.factor(hbond_stride100_trajectory$TM4))
```

```{r}
tuningGrid <- data.frame("alpha" = c(0.875), "lambda"= c(0.00046875))
set.seed(100)
thrombin_TM56_TM456_final_model = train(
  as.factor(TM4) ~ ., data = hbond_stride100_trajectory,
  method = "glmnet",
  lambda = 0.00046875,
  tuneGrid = tuningGrid,
  family = "multinomial",
  trControl = trainControl(method = "cv", number = 10)
)
```

```{r}
thrombin_TM56_TM456_final_model
```

```{r}
thrombin_TM56_TM456_final_model$results
```

```{r}
thrombin_TM56_TM456_final_model$control$p
```

```{r}
# Parameters
Beta <- coef(thrombin_TM56_TM456_final_model$finalModel)
```

```{r}
Beta1=Beta$`0`[,1]
Beta2=Beta$`1`[,1]
Beta3=Beta$`2`[,1]
```

```{r}
beta1 <- data.frame("thrombin" = c(Beta1[order(-Beta1), drop = FALSE][1:10], Beta1[order(-Beta1), drop = FALSE][321:331]))
beta2 <- data.frame("TM56" = c(Beta2[order(-Beta2), drop = FALSE][1:10], Beta2[order(-Beta2), drop = FALSE][321:331]))
beta3 <- data.frame("TM456" = c(Beta3[order(-Beta3), drop = FALSE][1:10], Beta3[order(-Beta3), drop = FALSE][321:331]))
```

```{r}
knitr::kable(beta1)
```

```{r}
knitr::kable(beta2)
```

```{r}
knitr::kable(beta3)
```

```{r}
# Sort top n hydrogen bonds
Beta1=Beta$`0`[,1]
Beta2=Beta$`1`[,1]
Beta3=Beta$`2`[,1]
beta1 <- data.frame("thrombin" = c(Beta1[order(-Beta1), drop = FALSE][1:10], Beta1[order(-Beta1), drop = FALSE][321:331]))
beta2 <- data.frame("TM56" = c(Beta2[order(-Beta2), drop = FALSE][1:10], Beta2[order(-Beta2), drop = FALSE][321:331]))
beta3 <- data.frame("TM456" = c(Beta3[order(-Beta3), drop = FALSE][1:10], Beta3[order(-Beta3), drop = FALSE][321:331]))
```

```{r}
# Combine Beta1, Beta2, Beta3, and Beta4 into a single vector
combined_beta <- c(Beta1, Beta2, Beta3)

# Calculate absolute values of the combined vector
abs_combined_beta <- abs(combined_beta)

# Sort the absolute values in descending order
sorted_abs_combined_beta <- sort(abs_combined_beta, decreasing = TRUE)

# Select the top 80 values
top_42_values <- sorted_abs_combined_beta[1:50];top_42_values
```

```{r}
# Create a named vector for the row names
rownames_combined <- c(paste("thrombin", rownames(Beta$`0`), sep = "_"),
                       paste("TM56", rownames(Beta$`1`), sep = "_"),
                       paste("TM456", rownames(Beta$`2`), sep = "_"))

# Create a data frame with the combined beta values and their row names
beta_df <- data.frame(Value = combined_beta, Rowname = rownames_combined)

# Calculate the absolute values and add them to the data frame
beta_df$AbsValue <- abs(beta_df$Value)

# Sort the data frame by the absolute values in descending order
sorted_beta_df <- beta_df[order(beta_df$AbsValue, decreasing = TRUE),]

# Select the top 80 rows
top_42_df <- sorted_beta_df[1:42,]

# Remove the 'AbsValue' column, as it is no longer needed
top_42_df$AbsValue <- NULL

# Display the top 80 values with their row names
print(top_42_df)
```

```{r}
# Top 29 hydrogen bonds for WT_dK9_E8K_R4A
Top29_WT_dK9_E8K_R4A <- c("SER58-GLN60","ARG56-LYS57","LEU132-ARG216","LEU132-ARG216","TYR32-LYS248","ARG56-PRO59","GLU112-GLU108","TYR32-LYS171","TYR126-LEU82","PHE275-TRP263","ARG233-GLU39","ARG104-PRO193","HIS123-PRO124","GLY35-GLU30","ARG98-ARG106","THR1-ASP71","ARG56-LYS57","GLN60-LYS57","ARG56-GLU61","ARG216-ASP211","THR277-ASP135","ARG72-LEU141","TYR83-LYS88","ARG173-ASP22","ARG109-TYR107","ASP133-ASN127","GLY46-HIS102","ARG104-GLU61","LEU180-GLN192")

# Elastic net for WT_dK9_E8K_R4A (only top 27)
tuningGrid <- data.frame("alpha" = c(0.875), "lambda"= c(0.00046875))
set.seed(100)
WT_dK9_E8K_R4A_final_model_only_top29 = train(
  as.factor(TM4) ~ ., data = hbond_stride100_trajectory[ , names(hbond_stride100_trajectory) %in% 
    c(Top29_WT_dK9_E8K_R4A,"TM4")],
  method = "glmnet",
  lambda=0.00046875,
  tuneGrid = tuningGrid,
  family = "multinomial",
  trControl = trainControl(method = "cv", number = 10)
)

# Parameters
Beta <- coef(WT_dK9_E8K_esR4A_final_model_only_top29$finalModel)

# Model summary
WT_dK9_E8K_R4A_final_model_only_top29
```
















