---
title: "Final Project"
author: "Dizhou Wu"
date: '2022-05-06'
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
# Import library
suppressMessages(library(rpart))
suppressMessages(library(rattle))
suppressMessages(library(glmnet))
suppressMessages(library(caret))
suppressMessages(library(rlang))
suppressMessages(library(ggplot2))
suppressMessages(library(ggmosaic))
suppressMessages(library(corrplot))
suppressMessages(library(RColorBrewer))
```

## WT_dK9
```{r}
# Load data
hbond_stride100_trajectory=read.csv("/deac/salsburyGrp/wud18/md/double_binding/hbond/WT_dK9/hbond_stride100_trajectory_selected.csv")
```

```{r}
# Replace headers
Colnames1 <- c("PHE2-THR1","LEU20-PHE15","ASP22-GLU25","LYS23-GLU44","LYS23-ASP42","THR24-ASP22","ARG26-GLU21","GLU30-ARG26","SER31-LEU28","TYR32-LYS248","ILE37-ASN179","VAL38-ASP235","SER41-VAL198","ASP42-ASP42","ALA43-LEU196","MET47-GLU44","VAL52-ALA66","MET53-ARG98","LEU54-CYS64","PHE55-LEU96","ARG56-GLU61","LYS57-ASP94","LYS57-ASN93","GLY65-SER241","ALA66-VAL52","LEU68-TRP50","ILE69-TRP73","ASP71-ASP71","ARG72-LEU141","ARG72-GLU295","ARG72-LYS142","TRP73-SER70","THR76-GLY65","ALA77-THR76","ALA78-ASP135","LEU81-ALA78","LEU82-ALA78","TYR83-LYS88","TRP86-TYR83","ASP87-PRO84","PHE90-LEU81","GLU92-GLU92","LEU96-PHE55","VAL97-SER115","ARG98-MET53","ILE99-LYS113","GLY100-GLN51","LYS101-ARG106","LYS101-GLU108","HSD102-GLU108","SER103-GLU108","ARG104-SER194","ARG104-PRO193","ARG104-LYS190","GLU108-GLU112","ILE111-GLU108","GLU112-GLU108","LYS113-ILE99","SER115-VAL97","SER115-LYS143","ILE120-GLU92","HSD123-ILE136","TYR126-LEU82","ASN127-ASP133","GLU130-ASN127","ASN131-ARG216","LEU132-ASN127","ASP133-ASN131","ARG134-ASP133","ARG134-ARG125","LYS140-LYS119","LYS140-GLU118","LYS142-MET116","LYS142-GLU118","VAL145-ASP71","SER148-ILE151","HSD152-PRO49","VAL154-LEU68","GLU160-GLU160","THR161-ASP158","ALA163-ARG159","LEU165-THR161","LEU166-ALA162","GLN167-LEU165","GLN167-SER164","GLY169-ILE203","LYS171-SER31","LYS171-GLU27","GLY172-LEU201","ARG173-THR24","VAL174-VAL199","THR175-GLN51","TRP177-ASP240","ASN179-GLU238","LEU180-GLN192","THR183-GLU238","THR183-LYS181","TRP184-GLU182","LYS190-GLU61","LEU196-HSD102","GLN197-GLY176","GLN197-VAL195","ASN200-THR24","ASN200-GLU27","ILE203-TYR170","VAL204-CYS223","GLU205-GLU205","ARG206-MET221","ARG206-THR218","ARG206-ASP219","VAL208-GLU205","LYS210-ARG206","SER212-VAL208","THR213-GLU265","ARG216-GLU130","THR218-ASP133","ASN220-ASP133","GLY225-PRO202","TYR226-ASN200","LYS227-GLU230","LYS227-GLU205","GLU230-LYS227","GLY231-PRO228","GLY234-ASP268","ALA236-ASP235","ASP240-CYS237","GLY243-ASP240","PHE245-GLY259","VAL246-ARG173","ASN252-TYR256","ASN253-SER249","ARG254-ASN252","ARG254-CYS9","ARG254-GLU6","TRP255-GLY10","GLN257-GLY259","GLY259-PHE245","ILE260-THR277","SER262-ASP135","TRP263-SER262","ASP268-ASP235","ARG269-GLU182","LYS272-ARG269","LYS272-GLU265","LYS272-SER212","GLY274-ASP235","PHE275-TRP263","THR277-ILE260","THR277-ASP135","HSD278-MET258","VAL279-MET258","ARG281-ASP219","LEU282-VAL279","LYS283-PRO157","GLN287-LYS283","LYS288-LYS284","VAL289-TRP285","ILE290-ILE286","GLN292-LYS288","THR1-GLU6","GLU25-ASP22","LEU28-GLU25","SER31-GLU27","SER48-THR175","LEU63-LEU54","ARG72-ASP71","VAL74-MET139","THR76-ALA137","ARG98-GLN60","MET116-SER115","ARG129-ASN127","ILE136-ARG134","ILE151-SER148","SER164-GLU160","TRP177-HSD102","LYS190-ASN187","GLN197-ASP42","VAL199-VAL174","ASP211-PRO207","SER212-CYS209","MET221-THR218","PHE222-TYR276","ASP235-VAL38","GLY239-SER241","MET247-TYR256","VAL261-GLY243","SER262-PHE275","LYS288-GLN292","ASP291-GLN287","PHE293-VAL289","GLY294-ILE290","GLN51-SER48","GLN51-VAL52","ASP71-SER70","HSD123-PRO124","TYR126-ASP135","LYS140-PHE293","TYR150-SER148","ASP158-ASP158")
Colnames2 <- c("ARG159-GLU160","TYR170-GLN167","SER241-HSD79","PHE251-SER249","MET258-PHE245","GLY274-ALA224","ARG281-ASN220","LYS283-PHE280","LYS283-GLN287","LEU62-GLY189","LYS88-TYR83","ASP94-THR91","ARG109-TYR107","GLY176-GLN197","GLN192-ASN179","GLN197-LEU196","ALA224-GLY274","GLY243-SER241","THR1-ASP8","LEU11-HSD152","LEU29-GLU25","THR91-ASP94","ASN93-THR91","ARG104-GLN192","ARG106-SER103","ILE111-ARG109","LYS119-GLU118","ASP149-ASP149","SER212-GLY271","THR213-LYS210","ASN220-THR218","LYS232-GLU27","ARG233-ASP270","ASN252-ASN252","ILE286-LEU282","ILE45-GLU44","ASN187-GLY191","ASP229-ASP229","TRP285-LEU282","GLU6-SER4","SER19-PHE15","GLU27-THR24","SER70-TRP73","LYS119-GLU92","TYR170-ASP34","LYS190-GLU238","TRP263-PHE275","TRP263-ASN131","SER4-GLU6","ARG104-VAL188","GLU61-PRO59","ARG72-GLU118","ASN89-ASN89","ARG281-HSD278","ILE286-LYS283","THR1-ASP71","ASP42-SER41","ASN127-ARG125","ASP133-ASN127","LYS210-ASP211","ASP270-ASP270","LYS248-TYR32","LYS88-TRP86","GLN167-ALA163","ILE215-THR213","ILE33-GLU30","ARG206-ILE217","LYS283-VAL279","ARG173-ASN200","TYR170-TYR32","LYS232-GLU230","LYS288-TRP285","TYR32-LEU29","ARG269-GLY266","THR24-ASN200","THR213-CYS209","GLN192-TRP177","GLN60-LYS57","THR105-SER103","THR105-SER194","THR277-SER262","ARG214-GLU265","ASP8-ASP8","ARG269-GLU265","THR1-ASP291","ILE33-LEU29","LYS101-SER103","SER194-THR105","ARG214-THR213","ASP211-VAL208","SER4-THR1","ARG26-GLU30","ARG36-ASP34","LYS181-ASP268","ASP219-ASP219","LEU28-THR24","TYR273-TYR226","GLY231-LYS227","ARG254-SER249","SER164-THR161","VAL195-SER194","LYS283-GLU6","LYS283-LEU156","TYR126-HSD123","TRP263-GLU238","ARG72-GLY294","THR185-GLU238","LYS210-ASP219","ASN220-HSD278","TYR32-LYS171","TYR32-LEU28","TYR256-GLU6","ARG129-GLU130","LEU165-ALA162","ASP34-GLU30","LYS272-GLY264","ARG254-ASP8","PHE2-GLU6","GLY35-SER31","ASN252-SER249","ARG206-GLU205","ASP34-SER31","ARG56-SER58","LYS227-ASP229","THR213-ILE215","GLY35-GLU30","GLY3-GLU6","ASN187-THR185","ILE217-ILE215","ARG134-ASP219","ARG36-GLU30","ARG36-GLU27","THR218-LEU132","THR1-SER4","ASP87-TYR83","TRP128-ASN127","ASN93-GLU92","LYS283-ASP158","GLY46-HSD102","ARG159-ASP158","LEU132-ASN131","ARG216-ASP133","THR185-THR183","HSD102-GLY100","GLU238-CYS237","ARG104-GLY191","SER48-HSD102","HSD102-LYS101","LYS18-PRO13","LYS18-ASP149","ARG233-GLU39","LYS23-GLU21","ARG26-GLU27","ARG106-GLU44","ARG36-GLU205","LEU156-GLY5","GLY3-ASP8","LEU20-LEU14","ARG106-GLU108","ARG104-GLU61","ARG104-TRP177","THR183-VAL188","LEU62-GLU61","TRP184-GLU238","TRP177-PRO193","LYS272-GLY266","LYS272-ASP235","SER19-LEU14","LEU180-GLY189","ARG104-ASN179","ARG129-ASP87","TYR83-HSD79","ASN89-LEU82")
Colnames <- c(Colnames1,Colnames2)
colnames(hbond_stride100_trajectory) <- Colnames 
```

```{r include=FALSE}
# Process data
a=rep(1, 5000)
b=rep(0, 5000)
c <- c(a,b)
hbond_stride100_trajectory$TM4 <- c
levels(as.factor(hbond_stride100_trajectory$TM4))
```

```{r}
test <- rbind(hbond_stride100_trajectory[4001:5000,],hbond_stride100_trajectory[9001:10000,])
hbond_stride100_trajectory <- rbind(hbond_stride100_trajectory[1:4000,],hbond_stride100_trajectory[5001:9000,])
```

```{r}
# Logistic regression
set.seed(100)
LogisticRegression = train(
  as.factor(TM4) ~ ., data = hbond_stride100_trajectory,
  method = "glm",
  family = "binomial",
  trControl = trainControl(method = "cv", number = 10)
)
```

```{r}
LogisticRegression
```


```{r}
LogisticRegression
```

```{r}
testClass <- predict(LogisticRegression, newdata = test)
testModel <- predict(LogisticRegression, newdata = test, type = "prob")
```

```{r}
testClass
```

```{r}
testModel$`1`
```

```{r}
min(testModel$`1`[1:1000])
```


```{r}
max(testModel$`0`[1:1000])
```

```{r}
# Compare them
Comparison <- data.frame("Prob" = testModel, "Class" = testClass)
#rownames(Comparison) <- c('(Intercept)',Colnames)
tmp1 <- Comparison[order(Comparison$Prob.0),]
#tmp2 <- Comparison[order(-Comparison$Elastic_net)[364:373],]
#Betas=rbind(tmp1,tmp2)
knitr::kable(tmp1)
```


```{r}
testModel$`1`[1:1000]
```

```{r}
testModel$`0`[1:1000]
```

```{r}
testModel$`1`[1:1000][order(testModel$`1`[1:1000])]
```


```{r}
tmp1 <- Comparison[order(-Comparison$Elastic_net)[1:10],]
tmp2 <- Comparison[order(-Comparison$Elastic_net)[364:373],]
```



```{r}
max(test$`1`[1001:2000])
```





```{r}
# Parameters
Beta1 <- coef(LogisticRegression$finalModel)
```

```{r}
# Table for parameters
knitr::kable(Beta1)
```

```{r}
alpha_list <- seq(from =0, to = 1, by =.0625)
EN <- function(Lambda) {
tuningGrid <- data.frame("alpha" = alpha_list, "lambda"= rep(Lambda, length(alpha_list)))
set.seed(100)
hbond_elnet = train(
  as.factor(TM4) ~ ., data = hbond_stride100_trajectory,
  method = "glmnet",
  lambda=Lambda,
  tuneGrid = tuningGrid,
  trControl = trainControl(method = "cv", number = 10)
)
return(hbond_elnet)
}
```

```{r}
lambda_list=seq(from =0, to = 0.005, by =.00015625)
EN_list=EN(lambda_list[1])$results$Accuracy
for (i in 2:length(lambda_list)){
  print(lambda_list[i])
  EN_list=data.frame(EN_list, EN(lambda_list[i])$results$Accuracy)
}
```

```{r}
# Row and column names
rownames(EN_list) <- alpha_list
colnames(EN_list) <- lambda_list
```

```{r}
# Save csv
write.csv(EN_list, "/deac/salsburyGrp/wud18/md/double_binding/hbond/elastic_net/WT_dK9.csv", row.names=TRUE)
```

```{r}
EN_list
```

```{r}
tuningGrid <- data.frame("alpha" = c(0.0625), "lambda"= c(0.0003125))
set.seed(100)
dK9_final_model = train(
  as.factor(TM4) ~ ., data = hbond_stride100_trajectory,
  method = "glmnet",
  lambda=0.0003125,
  tuneGrid = tuningGrid,
  trControl = trainControl(method = "cv", number = 10)
)
```

```{r}
dK9_final_model
```

```{r}
# Parameters
Beta2 <- as.numeric(coef(dK9_final_model$finalModel))
```

```{r}
# Compare them
Comparison <- data.frame("LogisticRegression" = Beta1, "Elastic_net" = Beta2)
rownames(Comparison) <- c('(Intercept)',Colnames)
tmp1 <- Comparison[order(-Comparison$Elastic_net)[1:10],]
tmp2 <- Comparison[order(-Comparison$Elastic_net)[364:373],]
Betas=rbind(tmp1,tmp2)
knitr::kable(Betas)
```


































## WT_E8K
```{r}
# Load data
hbond_stride100_trajectory=read.csv("/deac/salsburyGrp/wud18/md/double_binding/hbond/WT_E8K/hbond_stride100_trajectory_selected.csv")
```

```{r}
# Replace headers
Colnames1 <- c("PHE2-THR1","LEU20-PHE15","ASP22-GLU25","LYS23-GLU44","THR24-ASP22","ARG26-GLU21","GLU30-ARG26","SER31-LEU28","TYR32-LYS248","ILE37-ASN179","SER41-VAL198","ASP42-ASP42","ALA43-LEU196","MET47-GLU44","VAL52-ALA66","MET53-ARG98","LEU54-CYS64","PHE55-LEU96","ARG56-GLU61","LYS57-ASP94","LYS57-ASN93","ALA66-VAL52","LEU68-TRP50","ILE69-TRP73","ASP71-ASP71","ARG72-LEU141","ARG72-GLU295","ARG72-LYS142","TRP73-SER70","THR76-GLY65","ALA77-THR76","ALA78-ASP135","LEU81-ALA78","LEU82-ALA78","TYR83-LYS88","TRP86-TYR83","ASP87-PRO84","PHE90-LEU81","GLU92-GLU92","LEU96-PHE55","VAL97-SER115","ARG98-MET53","ILE99-LYS113","GLY100-GLN51","LYS101-ARG106","LYS101-GLU108","HSD102-GLU108","SER103-GLU108","ARG104-SER194","ARG104-PRO193","ARG104-GLY189","ARG104-LYS190","GLU108-GLU112","ILE111-GLU108","GLU112-GLU108","SER115-VAL97","SER115-LYS143","ILE120-GLU92","HSD123-ILE136","TYR126-LEU82","ASN127-ASP133","GLU130-ASN127","ASN131-ARG216","ARG134-ASP133","ARG134-ARG125","LYS140-LYS119","LYS140-GLU118","LYS142-MET116","LYS142-GLU118","VAL145-ASP71","SER148-ILE151","HSD152-PRO49","VAL154-LEU68","GLU160-GLU160","THR161-ASP158","ALA163-ARG159","LEU165-THR161","LEU166-ALA162","GLN167-LEU165","GLN167-SER164","GLY169-ILE203","LYS171-SER31","LYS171-GLU27","GLY172-LEU201","ARG173-ASP22","ARG173-THR24","VAL174-VAL199","THR175-GLN51","TRP177-ASP240","ASN179-GLU238","LEU180-GLN192","LYS181-THR183","THR183-GLU238","TRP184-GLU182","LYS190-GLU61","LEU196-HSD102","GLN197-GLY176","GLN197-VAL195","ASN200-THR24","ILE203-TYR170","VAL204-CYS223","GLU205-GLU205","ARG206-MET221","ARG206-THR218","ARG206-ASP219","VAL208-GLU205","LYS210-ARG206","SER212-VAL208","THR213-GLU265","ARG216-GLU130","THR218-ASP133","ASN220-ASP133","GLY225-PRO202","TYR226-ASN200","LYS227-GLU230","LYS227-GLU205","GLU230-LYS227","GLY231-PRO228","GLY234-ASP268","ALA236-ASP235","ASP240-CYS237","GLY243-ASP240","PHE245-GLY259","VAL246-ARG173","LYS248-GLU25","ASN252-TYR256","ASN253-SER249","ARG254-ASN252","ARG254-CYS9","ARG254-GLU6","GLN257-GLY259","GLY259-PHE245","ILE260-THR277","SER262-ASP135","TRP263-SER262","ASP268-ASP235","ARG269-GLU182","LYS272-ARG269","LYS272-GLU265","LYS272-SER212","GLY274-ASP235","PHE275-TRP263","THR277-ILE260","THR277-ASP135","HSD278-MET258","VAL279-MET258","ARG281-ASP219","LEU282-VAL279","LYS283-PRO157","GLN287-LYS283","LYS288-LYS284","VAL289-TRP285","ILE290-ILE286","GLN292-LYS288","THR1-GLU6","GLU25-ASP22","LEU28-GLU25","SER31-GLU27","SER48-THR175","LEU63-LEU54","ARG72-ASP71","VAL74-MET139","THR76-ALA137","ARG98-GLN60","MET116-SER115","ARG129-ASN127","ILE136-ARG134","ILE151-SER148","SER164-GLU160","TRP177-HSD102","LYS190-ASN187","GLN197-ASP42","VAL199-VAL174","ASP211-PRO207","SER212-CYS209","MET221-THR218","ASP235-VAL38","GLY239-SER241","MET247-TYR256","VAL261-GLY243","SER262-PHE275","LYS288-GLN292","ASP291-GLN287","PHE293-VAL289","GLY294-ILE290","GLN51-SER48","GLN51-VAL52","ASP71-SER70","HSD123-PRO124","TYR126-ASP135")
Colnames2 <- c("LYS140-PHE293","TYR150-SER148","ASP158-ASP158","ARG159-GLU160","TYR170-GLN167","SER241-HSD79","PHE251-SER249","MET258-PHE245","GLY274-ALA224","ARG281-ASN220","LYS283-PHE280","LYS283-GLN287","LEU62-GLY189","LYS88-TYR83","ASP94-THR91","ARG109-TYR107","GLY176-GLN197","GLN192-ASN179","GLN197-LEU196","ALA224-GLY274","GLY243-SER241","THR1-ASP8","LEU11-HSD152","LEU29-GLU25","THR91-ASP94","ASN93-THR91","ARG104-GLN192","ARG106-SER103","ILE111-ARG109","LYS119-GLU118","ASP149-ASP149","SER212-GLY271","THR213-LYS210","ASN220-THR218","ARG233-ASP270","ASN252-ASN252","ILE286-LEU282","ILE45-GLU44","ASN187-GLY191","ASP229-ASP229","TRP285-LEU282","SER19-PHE15","GLU27-THR24","SER70-TRP73","LYS119-GLU92","LYS143-SER115","LYS190-GLU238","TRP263-PHE275","TRP263-ASN131","SER4-GLU6","ARG104-VAL188","GLU61-PRO59","ARG72-GLU118","ARG281-HSD278","ILE286-LYS283","THR1-ASP71","ASP42-SER41","ASN127-ARG125","ASP133-ASN127","LYS210-ASP211","ASP270-ASP270","LYS248-TYR32","LYS88-TRP86","GLN167-ALA163","ILE215-THR213","ILE33-GLU30","ARG206-ILE217","LYS283-VAL279","ARG173-ASN200","TYR170-TYR32","LYS232-GLU230","LYS288-TRP285","TYR32-LEU29","THR213-CYS209","GLN192-TRP177","GLN60-LYS57","THR105-SER103","THR105-SER194","THR277-SER262","ARG214-GLU265","ASP8-ASP8","ARG269-GLU265","THR1-ASP291","ILE33-LEU29","LYS101-SER103","LYS181-GLU39","SER194-THR105","ARG214-THR213","ASP211-VAL208","SER4-THR1","ARG26-GLU30","ARG36-ASP34","GLY239-GLU238","SER241-GLU238","ASP219-ASP219","LEU28-THR24","TYR273-TYR226","GLY231-LYS227","ARG254-SER249","SER164-THR161","VAL195-SER194","LYS283-GLU6","LYS283-LEU156","TYR126-HSD123","ARG72-GLY294","TRP263-SER241","ASN220-HSD278","TYR32-LYS171","TYR32-LEU28","ARG129-GLU130","LEU165-ALA162","ASP34-GLU30","ARG254-ASP8","PHE2-GLU6","GLY35-SER31","ASN252-SER249","ARG206-GLU205","ARG56-SER58","LYS227-ASP229","THR213-ILE215","GLY35-GLU30","GLU6-GLY3","GLY3-GLU6","ASN187-THR185","ARG134-ASP219","ARG36-GLU30","ARG36-GLU27","THR218-LEU132","THR1-SER4","TRP128-ASN127","ASN93-GLU92","LYS283-ASP158","ARG216-ASN131","GLY46-HSD102","ARG159-ASP158","LEU132-ASN131","ARG216-ASP133","THR185-THR183","ASN131-ARG129","HSD102-GLY100","GLU238-CYS237","THR185-GLY191","ARG26-ASP22","GLU27-LYS23","ARG173-GLU25","TRP177-SER194","LYS23-GLU27","ARG104-GLY191","SER48-HSD102","HSD102-LYS101","LYS18-PRO13","LYS18-ASP149","ARG233-GLU39","LYS23-GLU21","TRP263-GLY266","ARG26-GLU27","ARG106-GLU44","ARG36-GLU205","ILE37-GLN197","LYS248-GLU21","ALA7-GLU6","LEU156-GLY5","ARG36-SER31","THR1-GLU295","GLY3-ASP71","PHE2-ASP71","ARG106-GLU108","ARG104-GLU61","ARG104-TRP177","LEU62-GLU61","TRP177-PRO193","LYS272-GLY266","TYR170-LYS248","TYR83-HSD79","ASN89-LEU82","ASP133-ASP133","ARG26-PRO250")
Colnames <- c(Colnames1,Colnames2)
colnames(hbond_stride100_trajectory) <- Colnames 
```

```{r include=FALSE}
# Process data
a=rep(1, 5000)
b=rep(0, 5000)
c <- c(a,b)
hbond_stride100_trajectory$TM4 <- c
levels(as.factor(hbond_stride100_trajectory$TM4))
```

```{r}
# Logistic regression
set.seed(100)
LogisticRegression = train(
  as.factor(TM4) ~ ., data = hbond_stride100_trajectory,
  method = "glm",
  family = "binomial",
  trControl = trainControl(method = "cv", number = 10)
)
```

```{r}
LogisticRegression
```

```{r}
# Parameters
Beta1 <- coef(LogisticRegression$finalModel)
```

```{r}
# Table for parameters
knitr::kable(Beta1)
```

```{r}
alpha_list <- seq(from =0, to = 1, by =.0625)
EN <- function(Lambda) {
tuningGrid <- data.frame("alpha" = alpha_list, "lambda"= rep(Lambda, length(alpha_list)))
set.seed(100)
hbond_elnet = train(
  as.factor(TM4) ~ ., data = hbond_stride100_trajectory,
  method = "glmnet",
  lambda=Lambda,
  tuneGrid = tuningGrid,
  trControl = trainControl(method = "cv", number = 10)
)
return(hbond_elnet)
}
```

```{r}
lambda_list=seq(from =0, to = 0.005, by =.00015625)
EN_list=EN(lambda_list[1])$results$Accuracy
for (i in 2:length(lambda_list)){
  print(lambda_list[i])
  EN_list=data.frame(EN_list, EN(lambda_list[i])$results$Accuracy)
}
```

```{r}
# Row and column names
rownames(EN_list) <- alpha_list
colnames(EN_list) <- lambda_list
```

```{r}
# Save csv
write.csv(EN_list, "/deac/salsburyGrp/wud18/md/double_binding/hbond/elastic_net/WT_E8K.csv", row.names=TRUE)
```

```{r}
EN_list
```

```{r}
tuningGrid <- data.frame("alpha" = c(0.1875), "lambda"= c(0.00109375))
set.seed(100)
E8K_final_model = train(
  as.factor(TM4) ~ ., data = hbond_stride100_trajectory,
  method = "glmnet",
  lambda=0.0003125,
  tuneGrid = tuningGrid,
  trControl = trainControl(method = "cv", number = 10)
)
```

```{r}
E8K_final_model
```

```{r}
# Parameters
Beta2 <- as.numeric(coef(E8K_final_model$finalModel))
```

```{r}
# Compare them
Comparison <- data.frame("LogisticRegression" = Beta1, "Elastic_net" = Beta2)
rownames(Comparison) <- c('(Intercept)',Colnames)
tmp1 <- Comparison[order(-Comparison$Elastic_net)[1:10],]
tmp2 <- Comparison[order(-Comparison$Elastic_net)[364:373],]
Betas=rbind(tmp1,tmp2)
knitr::kable(Betas)
```



















## WT_R4A
```{r}
# Load data
hbond_stride100_trajectory=read.csv("/deac/salsburyGrp/wud18/md/double_binding/hbond/WT_R4A/hbond_stride100_trajectory_selected.csv")
```

```{r}
# Replace headers
Colnames1 <- c("PHE2-THR1","LEU20-PHE15","ASP22-GLU25","LYS23-GLU44","THR24-ASP22","ARG26-GLU21","GLU30-ARG26","SER31-LEU28","TYR32-LYS248","ILE37-ASN179","SER41-VAL198","ASP42-ASP42","ALA43-LEU196","MET47-GLU44","VAL52-ALA66","MET53-ARG98","LEU54-CYS64","PHE55-LEU96","ARG56-GLU61","LYS57-ASP94","LYS57-ASN93","ALA66-VAL52","LEU68-TRP50","ILE69-TRP73","ASP71-ASP71","ARG72-LEU141","ARG72-GLU295","ARG72-LYS142","TRP73-SER70","THR76-GLY65","ALA77-THR76","ALA78-ASP135","LEU81-ALA78","LEU82-ALA78","TRP86-TYR83","ASP87-PRO84","PHE90-LEU81","GLU92-GLU92","LEU96-PHE55","VAL97-SER115","ARG98-MET53","ILE99-LYS113","GLY100-GLN51","LYS101-ARG106","LYS101-GLU108","LYS101-GLU112","HSD102-GLU108","SER103-GLU108","ARG104-SER194","ARG104-PRO193","ARG104-GLY189","ARG104-LYS190","GLU108-GLU112","ILE111-GLU108","GLU112-GLU108","SER115-VAL97","SER115-LYS143","ILE120-GLU92","HSD123-ILE136","TYR126-LEU82","ASN127-ASP133","GLU130-ASN127","ASN131-ARG216","LEU132-ASN127","ARG134-ASP133","ARG134-ARG125","LYS140-LYS119","LYS140-GLU118","LYS142-MET116","LYS142-GLU118","VAL145-ASP71","SER148-ILE151","HSD152-PRO49","VAL154-LEU68","GLU160-GLU160","THR161-ASP158","ALA163-ARG159","LEU165-THR161","LEU166-ALA162","GLN167-LEU165","GLN167-SER164","GLY169-ILE203","LYS171-SER31","LYS171-GLU27","GLY172-LEU201","ARG173-ASP22","ARG173-THR24","VAL174-VAL199","THR175-GLN51","ASN179-GLU238","LEU180-GLN192","LYS181-THR183","TRP184-GLU182","LYS190-GLU61","LEU196-HSD102","GLN197-GLY176","GLN197-VAL195","ASN200-THR24","LEU201-GLY172","ILE203-TYR170","VAL204-CYS223","GLU205-GLU205","ARG206-MET221","ARG206-THR218","ARG206-ASP219","VAL208-GLU205","LYS210-ARG206","SER212-VAL208","THR213-GLU265","ARG216-GLU130","THR218-ASP133","ASN220-ASP133","GLY225-PRO202","TYR226-ASN200","LYS227-GLU230","LYS227-GLU205","GLU230-LYS227","GLY231-PRO228","GLY234-ASP268","ALA236-ASP235","ASP240-CYS237","GLY243-ASP240","PHE245-GLY259","VAL246-ARG173","LYS248-GLU25","ASN252-TYR256","ASN253-SER249","ARG254-ASN252","ARG254-ALA7","ARG254-CYS9","ARG254-GLU6","GLN257-GLY259","GLY259-PHE245","ILE260-THR277","SER262-ASP135","TRP263-SER262","ASP268-ASP235","LYS272-ARG269","LYS272-GLU265","LYS272-SER212","PHE275-TRP263","THR277-ILE260","HSD278-ASN220","HSD278-MET258","VAL279-MET258","ARG281-ASP219","LEU282-VAL279","LYS283-PRO157","GLN287-LYS283","LYS288-LYS284","VAL289-TRP285","ILE290-ILE286","GLN292-LYS288","THR1-GLU6","GLU25-ASP22","LEU28-GLU25","SER31-GLU27","SER48-THR175","LEU63-LEU54","ARG72-ASP71","VAL74-MET139","THR76-ALA137","ARG98-GLN60","MET116-SER115","ARG129-ASN127","ILE136-ARG134","ILE151-SER148","SER164-GLU160","TRP177-HSD102","LYS190-ASN187","GLN197-ASP42","VAL199-VAL174","ASP211-PRO207","SER212-CYS209","MET221-THR218","ASP235-VAL38","GLY239-SER241","MET247-TYR256","VAL261-GLY243","SER262-PHE275","LYS288-GLN292","ASP291-GLN287","PHE293-VAL289","GLY294-ILE290","GLN51-SER48","GLN51-VAL52","ASP71-SER70","HSD123-PRO124","TYR126-ASP135","LYS140-PHE293","TYR150-SER148","ASP158-ASP158","ARG159-GLU160","TYR170-GLN167","GLN192-ASN187","SER241-HSD79","PHE251-SER249","MET258-PHE245")
Colnames2 <- c("GLY274-ALA224","ARG281-ASN220","LYS283-PHE280","LYS283-GLN287","LEU62-GLY189","LYS88-TYR83","ASP94-THR91","ARG109-TYR107","GLY176-GLN197","GLN192-ASN179","GLN197-LEU196","ALA224-GLY274","GLY243-SER241","THR1-ASP8","LEU11-HSD152","LEU29-GLU25","THR91-ASP94","ASN93-THR91","ARG104-GLN192","ARG106-SER103","ILE111-ARG109","LYS119-GLU118","ASP149-ASP149","SER212-GLY271","THR213-LYS210","ASN220-THR218","ARG233-ASP270","ASN252-ASN252","ILE286-LEU282","ILE45-GLU44","ASN187-GLY191","ASP229-ASP229","TRP285-LEU282","GLU6-SER4","SER19-PHE15","GLU27-THR24","SER70-TRP73","LYS119-GLU92","LYS143-SER115","LYS190-GLU238","TRP263-ASN131","SER4-GLU6","ARG104-VAL188","GLU61-PRO59","ARG72-GLU118","ASN89-ASN89","ARG281-HSD278","ILE286-LYS283","THR1-ASP71","ASP42-SER41","ASN127-ARG125","ASP133-ASN127","LYS210-ASP211","ASP270-ASP270","LYS88-TRP86","GLN167-ALA163","ILE215-THR213","ILE33-GLU30","ARG206-ILE217","LYS283-VAL279","ARG173-ASN200","TYR170-TYR32","LYS232-GLU230","LYS288-TRP285","TYR32-LEU29","THR213-CYS209","GLN192-TRP177","GLN60-LYS57","THR105-SER103","THR105-SER194","ARG214-GLU265","ASN131-ASN131","ASP8-ASP8","ARG269-GLU265","THR1-ASP291","ILE33-LEU29","LYS101-SER103","SER194-THR105","ARG214-THR213","ASP211-VAL208","SER4-THR1","ARG26-GLU30","ARG36-ASP34","GLY239-GLU238","LYS181-ASP268","ASP219-ASP219","LEU28-THR24","TYR273-SER212","TYR273-TYR226","GLY231-LYS227","ARG254-SER249","SER164-THR161","SER249-ASN252","VAL195-SER194","LYS283-GLU6","LYS283-LEU156","TYR126-HSD123","TRP263-GLU238","ARG72-GLY294","TRP184-THR183","ASN220-HSD278","TYR32-LYS171","ALA7-SER4","TYR32-LEU28","GLY191-ASN187","TYR256-GLU6","ARG129-GLU130","LEU165-ALA162","ASP34-GLU30","LYS272-GLY264","ARG254-ASP8","PHE2-GLU6","GLY35-SER31","ASN252-SER249","ARG206-GLU205","ARG56-SER58","LYS227-ASP229","TRP73-GLY294","GLY35-GLU30","GLY3-GLU6","ASN187-THR185","ILE217-ILE215","ARG134-ASP219","ARG36-GLU30","ARG36-GLU27","THR218-LEU132","THR1-SER4","TRP128-ASN127","ASN93-GLU92","LYS283-ASP158","ARG216-ASN131","GLY46-HSD102","ARG159-ASP158","LEU132-ASN131","ARG216-ASP133","THR185-THR183","ASN187-TRP184","ASN131-ARG129","THR218-ASN131","GLU238-CYS237","THR185-GLY191","ARG26-ASP22","GLU27-LYS23","ARG173-GLU25","LYS23-GLU27","ARG104-GLY191","SER48-HSD102","HSD102-LYS101","LYS18-PRO13","LYS18-ASP149","ARG233-GLU39","LYS23-GLU21","ARG26-GLU27","ARG106-GLU44","ARG36-GLU205","ARG125-HSD123","LYS248-GLU21","ARG106-HSD102","ARG36-SER31","GLY3-ASP8","ARG106-GLU108","ARG104-GLU61","ARG104-TRP177","LEU62-GLU61","TRP177-PRO193","LYS272-GLY266","LYS272-ASP235","TYR170-LYS248","ARG281-ASP133","LYS171-GLU25")
Colnames <- c(Colnames1,Colnames2)
colnames(hbond_stride100_trajectory) <- Colnames 
```

```{r include=FALSE}
# Process data
a=rep(1, 5000)
b=rep(0, 5000)
c <- c(a,b)
hbond_stride100_trajectory$TM4 <- c
levels(as.factor(hbond_stride100_trajectory$TM4))
```

```{r}
# Logistic regression
set.seed(100)
LogisticRegression = train(
  as.factor(TM4) ~ ., data = hbond_stride100_trajectory,
  method = "glm",
  family = "binomial",
  trControl = trainControl(method = "cv", number = 10)
)
```

```{r}
LogisticRegression
```

```{r}
# Parameters
Beta1 <- coef(LogisticRegression$finalModel)
```

```{r}
# Table for parameters
knitr::kable(Beta1)
```

```{r}
alpha_list <- seq(from =0, to = 1, by =.0625)
EN <- function(Lambda) {
tuningGrid <- data.frame("alpha" = alpha_list, "lambda"= rep(Lambda, length(alpha_list)))
set.seed(100)
hbond_elnet = train(
  as.factor(TM4) ~ ., data = hbond_stride100_trajectory,
  method = "glmnet",
  lambda=Lambda,
  tuneGrid = tuningGrid,
  trControl = trainControl(method = "cv", number = 10)
)
return(hbond_elnet)
}
```

```{r}
lambda_list=seq(from =0, to = 0.005, by =.00015625)
EN_list=EN(lambda_list[1])$results$Accuracy
for (i in 2:length(lambda_list)){
  print(lambda_list[i])
  EN_list=data.frame(EN_list, EN(lambda_list[i])$results$Accuracy)
}
```

```{r}
# Row and column names
rownames(EN_list) <- alpha_list
colnames(EN_list) <- lambda_list
```

```{r}
# Save csv
write.csv(EN_list, "/deac/salsburyGrp/wud18/md/double_binding/hbond/elastic_net/WT_R4A.csv", row.names=TRUE)
```

```{r}
EN_list
```

```{r}
tuningGrid <- data.frame("alpha" = c(0.5), "lambda"= c(0.00046875))
set.seed(100)
R4A_final_model = train(
  as.factor(TM4) ~ ., data = hbond_stride100_trajectory,
  method = "glmnet",
  lambda=0.0003125,
  tuneGrid = tuningGrid,
  trControl = trainControl(method = "cv", number = 10)
)
```

```{r}
R4A_final_model
```

```{r}
# Parameters
Beta2 <- as.numeric(coef(R4A_final_model$finalModel))
```

```{r}
# Compare them
Comparison <- data.frame("LogisticRegression" = Beta1, "Elastic_net" = Beta2)
rownames(Comparison) <- c('(Intercept)',Colnames)
tmp1 <- Comparison[order(-Comparison$Elastic_net)[1:10],]
tmp2 <- Comparison[order(-Comparison$Elastic_net)[364:373],]
Betas=rbind(tmp1,tmp2)
knitr::kable(Betas)
```























