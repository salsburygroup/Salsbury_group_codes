---
title: "Logistic regression for Hbond analysis"
author: "Dizhou Wu"
date: "3/24/2022"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
suppressMessages(library(rlang))
suppressMessages(library(ggplot2))
suppressMessages(library(ggmosaic))
```

```{r}
## Thrombin TM56 TM456
# Read data
hbond_stride100_trajectory=read.csv("/deac/salsburyGrp/wud18/md/TM/hbond/hbond_stride100_thrombin_TM56_TM456_trajectory_selected.csv")
```

```{r}
# Replace headers
Colnames1 <- c("THR1-GLU295","ARG12-GLU16","ARG12-ASP22","ARG12-MET47","GLU16-GLU16","LYS17-ARG12","LYS17-ASP8","LYS18-PHE15","SER19-GLU16","LEU20-PHE15","ASP22-GLU25","LYS23-GLU44","THR24-ASP22","GLU25-ASP22","ARG26-GLU30","LEU28-GLU25","GLU30-ARG26","SER31-LEU28","TYR32-LYS248","SER41-VAL198","ALA43-LEU196","MET47-GLU44","SER48-THR175","GLN51-SER48","VAL52-ALA66","MET53-ARG98","LEU54-CYS64","ARG56-GLU61","LYS57-ASP94","LYS57-ASN93","GLN60-LYS57","ALA66-VAL52","ARG72-ASP71","ARG72-LEU141","ARG72-GLU118","VAL74-MET139","THR76-ALA137","THR76-GLY65","ALA77-THR76","ALA78-ASP135","LEU81-ALA78","LEU82-ALA78","TYR83-LYS88","ASP87-PRO84","PHE90-LEU81","THR91-ASP94","GLU92-GLU92","ASP94-THR91","ARG98-MET53","ILE99-LYS113","ARG104-PRO193","GLU108-GLU112","ILE111-GLU108","ILE111-ARG109","GLU112-GLU108","LYS119-GLU92","TYR126-LEU82","ASN127-ASP133","ASP133-ASN127","LYS140-PHE293","LYS140-GLU118","VAL145-ASP71","SER148-ILE151","ARG159-GLU160","THR161-ASP158","ALA162-ASP158","SER164-GLU160","LEU165-THR161","LEU166-ALA162","GLN167-LEU165","GLN167-SER164","GLY169-ILE203","TYR170-ASP34","LYS171-SER31","LYS171-GLU27","GLY172-LEU201","ARG173-ASP22","ARG173-THR24","VAL174-VAL199","GLY176-GLN197","TRP177-HIS102","ASN179-GLU238","LYS181-GLU39","THR183-GLU182","LEU196-HIS102","GLN197-GLY176","GLN197-ASP42","GLN197-LEU196","ASN200-THR24","ASN200-GLU27","ILE203-TYR170","VAL204-CYS223","GLU205-GLU205","ARG206-ASP219","ARG206-MET221","ARG206-THR218","CYS209-GLU205","ASP211-PRO207","SER212-VAL208","SER212-CYS209","THR213-GLU265","ARG216-ASN131","THR218-ASP133","ALA224-GLY274","TYR226-ASN200","LYS227-GLU230","LYS227-GLU205","GLU230-LYS227","LYS232-GLU27","ARG233-ASP268","ARG233-ASP270","ALA236-ASP235","GLU238-CYS237","ASP240-CYS237","GLY243-ASP240","PHE245-GLY259","VAL246-ARG173","MET247-TYR256","LYS248-ASN253","LYS248-GLU16","LYS248-GLU25","ASN252-ASN252","ASN252-TYR256","ASN253-SER249","ARG254-ASN252","ARG254-ASP8","ARG254-CYS9","TRP255-GLY10","GLN257-GLY259","MET258-PHE245","GLY259-PHE245","VAL261-GLY243","SER262-PHE275","ASP268-ASP235","ARG269-GLU182","LYS272-GLU265","LYS272-SER212","GLY274-ALA224","PHE275-TRP263","THR277-ILE260","THR277-ASP135","HIS278-ASN220","VAL279-MET258","LEU282-VAL279","LYS283-GLN287","LYS283-PRO157","ILE286-LEU282","GLN287-LYS283","VAL289-TRP285","ASP291-GLN287","GLN292-LYS288","PHE293-VAL289","GLY294-ILE290","THR1-ASP291","ILE37-ASN179","TRP50-SER48","ARG56-SER58","LEU63-LEU54")
Colnames2 <- c("ILE69-TRP73","SER70-TRP73","ASP71-SER70","ASP71-ASP71","ARG72-GLU295","ARG72-LYS142","LYS88-TYR83","VAL97-SER115","ARG104-GLN192","HIS123-ILE136","ASN131-ARG216","TYR150-SER148","ILE151-SER148","VAL154-LEU68","GLU160-GLU160","ALA163-ARG159","SER164-THR161","VAL199-VAL174","LYS210-ARG206","LYS210-ASP219","ARG216-GLU130","ASN220-THR218","ASP229-ASP229","ASP235-VAL38","SER241-HIS79","TRP255-GLU16","CYS267-GLU182","LYS288-LYS284","ILE290-ILE286","LEU11-HIS152","PHE15-ARG12","LYS18-PRO13","TYR32-LYS171","SER48-MET47","GLN51-VAL52","TRP73-SER70","SER115-MET116","TYR126-HIS123","ILE136-ARG134","LYS140-GLU295","HIS152-PRO49","CYS155-TRP255","GLN167-ALA163","ARG173-ASN200","GLN197-VAL195","LYS210-ILE217","ARG214-ASP211","ARG281-HIS278","TRP285-LEU282","LEU29-GLU25","THR105-SER194","MET221-THR218","GLY239-SER241","PHE251-SER249","ASN252-SER249","ILE260-THR277","GLU16-ARG12","LYS17-PRO13","LYS18-LEU14","LEU28-THR24","TYR32-LEU29","ARG129-ASN127","TYR170-GLN167","GLN192-ASN179","SER194-SER103","VAL208-GLU205","LYS272-ARG269","LYS283-PHE280","GLY35-ASP34","SER58-GLN60","ARG106-SER103","LYS283-VAL279","LYS283-LEU156","LYS119-GLU118","SER19-PHE15","SER194-THR105","SER241-SER262","GLY234-ASP268","ILE33-TYR170","ARG72-GLY294","ASN187-THR185","THR218-ASN131","ILE286-LYS283","ARG109-TYR107","LYS142-GLU118","LEU180-GLN192","LYS288-ASP291","ILE33-GLU30","GLU61-PRO59","PHE2-THR1","CYS9-ASP8","MET258-TYR256","TRP86-TYR83","LYS88-TRP86","ARG159-ASP158","TYR32-LEU28","LYS283-ASP158","SER19-SER19","ILE33-LEU29","ARG36-GLY35","ASP158-THR161","LYS119-LYS140","LEU165-ALA162","ILE217-ILE215","LYS232-GLU230","GLY243-SER241","ARG36-ASP34","ARG104-TRP177","TRP128-ASN127","THR183-GLU238","LYS210-ASP211","VAL195-SER194","ARG26-GLU21","SER31-GLU27","ARG214-GLU265","LYS248-TYR32","ASN220-HIS278","ASP211-VAL208","ILE215-THR213","GLU27-THR24","ASP229-LYS227","ILE120-GLU92","TRP86-GLU238","ARG98-ARG106","GLU61-ARG56","TYR170-ALA168","HIS152-ILE151","ARG206-ILE217","LEU62-GLU61","CYS64-LEU54","ARG104-GLU61","ASN131-ARG129","HIS152-SER148","LYS113-ASN110","ARG173-MET47","THR1-GLU6","GLN257-GLN257","LYS283-GLU6","TRP263-SER262","ARG36-GLU30","LYS227-ASP229","SER48-SER48","ARG26-ASP22","ARG56-LYS57","ARG56-PRO59","LYS17-ASP149","HIS278-MET258","ARG216-ASP211","ARG281-ASP219","ASP219-ASP219","LEU132-ASN131","LYS23-GLU21","THR218-LEU132","SER212-GLY271","LYS140-LEU141","LYS181-LYS190","GLY231-GLU230","LYS232-GLU39","THR213-CYS209","ARG134-ASP219","TYR273-SER212","GLY46-HIS102","ALA7-GLY3","GLY35-GLU30","ASP34-GLU30","GLU27-LYS23","ARG173-GLU25","THR1-ASP71","THR277-SER262","ARG233-GLU39","LEU132-ARG216","HIS123-PRO124")
Colnames <- c(Colnames1,Colnames2)
colnames(hbond_stride100_trajectory) <- Colnames 
```

```{r}
# Add column TM4
a=rep(0, 8000)
b=rep(1, 8000)
c=rep(2, 8000)
d <- c(a,b,c)
hbond_stride100_trajectory$TM4 <- d
levels(as.factor(hbond_stride100_trajectory$TM4))x
```

```{r}
# Logistic regression (penalized)
alpha_list <- seq(from =0, to = 1, by =.0625)
#alpha_list <- seq(from =0, to = 1, by =.5)
EN <- function(Lambda) {
tuningGrid <- data.frame("alpha" = alpha_list, "lambda"= rep(Lambda, length(alpha_list)))
set.seed(100)
hbond_elnet = train(
  as.factor(TM4) ~ ., data = hbond_stride100_trajectory,
  method = "glmnet",
  lambda=Lambda,
  tuneGrid = tuningGrid,
  family = "multinomial",
  trControl = trainControl(method = "cv", number = 10)
)
return(hbond_elnet)
}
```

```{r}
lambda_list=seq(from =0, to = 0.005, by =.00015625)
#lambda_list=seq(from =0, to = 0.005, by =0.0025)
EN_list=EN(lambda_list[1])$results$Accuracy
for (i in 2:length(lambda_list)){
  print(lambda_list[i])
  EN_list=data.frame(EN_list, EN(lambda_list[i])$results$Accuracy)
}
```

```{r}
# Row and column names
rownames(EN_list) <- alpha_list
colnames(EN_list) <- lambda_list
```

```{r}
# Save csv
write.csv(EN_list, "/deac/salsburyGrp/wud18/md/TM/logistic_regression_Hbond/thrombin_TM56_TM456.csv", row.names=TRUE)
```










```{r}
## Thrombin TM56
# Read data
hbond_stride100_trajectory=read.csv("/deac/salsburyGrp/wud18/md/TM/hbond/hbond_stride100_thrombin_TM56_trajectory_selected.csv")
```

```{r}
# Replace headers
Colnames1 <- c("ARG12-GLU16","ARG12-ASP22","ARG12-MET47","GLU16-GLU16","LYS17-ARG12","LYS18-PHE15","SER19-GLU16","LEU20-PHE15","ASP22-GLU25","LYS23-GLU44","THR24-ASP22","GLU25-ASP22","ARG26-GLU30","LEU28-GLU25","GLU30-ARG26","SER31-LEU28","TYR32-LYS248","SER41-VAL198","MET47-GLU44","SER48-THR175","GLN51-SER48","MET53-ARG98","LEU54-CYS64","LYS57-ASP94","LYS57-ASN93","GLN60-LYS57","ALA66-VAL52","ARG72-ASP71","ARG72-LEU141","ARG72-GLU118","THR76-ALA137","ALA77-THR76","ALA78-ASP135","LEU81-ALA78","LEU82-ALA78","ASP87-PRO84","PHE90-LEU81","THR91-ASP94","GLU92-GLU92","ASP94-THR91","ARG98-MET53","ARG104-PRO193","ILE111-GLU108","ILE111-ARG109","GLU112-GLU108","LYS119-GLU92","ASN127-ASP133","ASP133-ASN127","LYS140-PHE293","LYS140-GLU118","VAL145-ASP71","SER148-ILE151","ARG159-GLU160","THR161-ASP158","ALA162-ASP158","SER164-GLU160","LEU165-THR161","LEU166-ALA162","GLN167-LEU165","GLN167-SER164","GLY169-ILE203","LYS171-SER31","LYS171-GLU27","ARG173-ASP22","ARG173-THR24","VAL174-VAL199","GLY176-GLN197","TRP177-HIS102","ASN179-GLU238","LYS181-GLU39","THR183-GLU182","LEU196-HIS102","GLN197-GLY176","GLN197-ASP42","GLN197-LEU196","ASN200-THR24","ASN200-GLU27","VAL204-CYS223","GLU205-GLU205","ARG206-ASP219","ARG206-MET221","ARG206-THR218","CYS209-GLU205","ASP211-PRO207","SER212-VAL208","SER212-CYS209","THR213-GLU265","THR218-ASP133","ALA224-GLY274","TYR226-ASN200","LYS227-GLU230","LYS227-GLU205","GLU230-LYS227","LYS232-GLU27","ARG233-ASP270","ALA236-ASP235","GLU238-CYS237","ASP240-CYS237","GLY243-ASP240","MET247-TYR256","LYS248-ASN253","LYS248-GLU16","LYS248-GLU25","ASN252-TYR256","ASN253-SER249","ARG254-ASN252","ARG254-ASP8","ARG254-CYS9","GLN257-GLY259","MET258-PHE245","GLY259-PHE245","VAL261-GLY243","SER262-PHE275","ASP268-ASP235","LYS272-GLU265","LYS272-SER212","GLY274-ALA224","PHE275-TRP263","THR277-ILE260","THR277-ASP135","VAL279-MET258","LEU282-VAL279","LYS283-GLN287","LYS283-PRO157","ILE286-LEU282","GLN287-LYS283","VAL289-TRP285","ASP291-GLN287")
Colnames2 <- c("PHE293-VAL289","GLY294-ILE290","THR1-ASP291","ILE37-ASN179","TRP50-SER48","ARG56-SER58","ILE69-TRP73","SER70-TRP73","ASP71-SER70","ASP71-ASP71","ARG72-GLU295","LYS88-TYR83","VAL97-SER115","HIS123-ILE136","ASN131-ARG216","TYR150-SER148","ILE151-SER148","VAL154-LEU68","GLU160-GLU160","ALA163-ARG159","VAL199-VAL174","LYS210-ARG206","LYS210-ASP219","ARG216-GLU130","ASN220-THR218","ASP229-ASP229","ASP235-VAL38","SER241-HIS79","TRP255-GLU16","CYS267-GLU182","LYS288-LYS284","ILE290-ILE286","LEU11-HIS152","PHE15-ARG12","TYR32-LYS171","SER48-MET47","GLN51-VAL52","TRP73-SER70","SER115-MET116","TYR126-HIS123","ILE136-ARG134","LYS140-GLU295","HIS152-PRO49","CYS155-TRP255","GLN167-ALA163","ARG173-ASN200","GLN197-VAL195","LYS210-ILE217","ARG281-HIS278","TRP285-LEU282","LEU29-GLU25","THR105-SER194","MET221-THR218","GLY239-SER241","PHE251-SER249","ASN252-SER249","ILE260-THR277","GLU16-ARG12","LYS17-PRO13","LYS18-LEU14","LEU28-THR24","TYR32-LEU29","ARG129-ASN127","TYR170-GLN167","GLN192-ASN179","SER194-SER103","VAL208-GLU205","LYS272-ARG269","GLY35-ASP34","SER58-GLN60","ARG106-SER103","LYS283-VAL279","LYS283-LEU156","LYS119-GLU118","SER19-PHE15","SER194-THR105","GLY234-ASP268","ILE33-TYR170","ARG72-GLY294","ASN187-THR185","ARG109-TYR107","LYS142-GLU118","LEU180-GLN192","LYS288-ASP291","GLU61-PRO59","PHE2-THR1","CYS9-ASP8","MET258-TYR256","TRP86-TYR83","LYS88-TRP86","ARG159-ASP158","TYR32-LEU28","LYS283-ASP158","ILE33-LEU29","ARG36-GLY35","ASP158-THR161","LEU165-ALA162","ILE217-ILE215","GLY243-SER241","ARG36-ASP34","ARG104-TRP177","TRP128-ASN127","THR183-GLU238","VAL195-SER194","ARG26-GLU21","SER31-GLU27","ARG214-GLU265","LYS248-TYR32","ASN220-HIS278","ILE215-THR213","ASP229-LYS227","ILE120-GLU92","TRP86-GLU238","GLU61-ARG56","HIS152-ILE151","ARG206-ILE217","LEU62-GLU61","CYS64-LEU54","ARG104-GLU61","ASN131-ARG129","HIS152-SER148","THR1-GLU6","GLN257-GLN257","LYS283-GLU6","TRP263-SER262","ARG36-GLU30","LYS227-ASP229","ARG26-ASP22","ARG56-LYS57","LYS17-ASP149","HIS278-MET258","ARG281-ASP219","ASP219-ASP219","LEU132-ASN131","LYS23-GLU21","SER212-GLY271","LYS140-LEU141","LYS232-GLU39","THR213-CYS209","ARG134-ASP219","TYR273-SER212","GLY46-HIS102","GLU27-LYS23","ARG173-GLU25","THR277-SER262","ARG233-GLU39","HIS123-PRO124")
Colnames <- c(Colnames1,Colnames2)
colnames(hbond_stride100_trajectory) <- Colnames 
```

```{r}
# Add column TM4
a=rep(0, 8000)
b=rep(1, 8000)
d <- c(a,b)
hbond_stride100_trajectory$TM4 <- d
levels(as.factor(hbond_stride100_trajectory$TM4))
```

```{r}
# Train the logistic regression model
m2 <- glm(formula = TM4 ~ ., data=hbond_stride100_trajectory, family='binomial')
```

```{r}
# Save coef
coef <- data.frame(m2$coefficients)
write.csv(coef, "/deac/salsburyGrp/wud18/md/TM/logistic_regression_Hbond/thrombin_TM56.csv", row.names = TRUE)
```

```{r}
# Coef in order
coef_sorted <- sort(m2$coefficients, decreasing = TRUE)
knitr::kable(c(coef_sorted[1:10],coef_sorted[266:275]))
```

```{r}
alpha_list <- seq(from =0, to = 1, by =.0625)
EN <- function(Lambda) {
tuningGrid <- data.frame("alpha" = alpha_list, "lambda"= rep(Lambda, length(alpha_list)))
set.seed(100)
hbond_elnet = train(
  as.factor(TM4) ~ ., data = hbond_stride100_trajectory,
  method = "glmnet",
  lambda=Lambda,
  tuneGrid = tuningGrid,
  trControl = trainControl(method = "cv", number = 10)
)
return(hbond_elnet)
}
```

```{r}
lambda_list=seq(from =0, to = 0.005, by =.00015625)
EN_list=EN(lambda_list[1])$results$Accuracy
for (i in 2:length(lambda_list)){
  print(lambda_list[i])
  EN_list=data.frame(EN_list, EN(lambda_list[i])$results$Accuracy)
}
```

```{r}
# Row and column names
rownames(EN_list) <- alpha_list
colnames(EN_list) <- lambda_list
```

```{r}
# Save csv
write.csv(EN_list, "/deac/salsburyGrp/wud18/md/TM/logistic_regression_Hbond/thrombin_TM56.csv", row.names=TRUE)
```




























```{r}
## Thrombin TM456
# Read data
hbond_stride100_trajectory=read.csv("/deac/salsburyGrp/wud18/md/TM/hbond/hbond_stride100_thrombin_TM456_trajectory_selected.csv")
```

```{r}
# Replace headers
Colnames1 <- c("THR1-GLU295","ARG12-GLU16","ARG12-ASP22","ARG12-MET47","GLU16-GLU16","LYS17-ARG12","LYS18-PHE15","SER19-GLU16","LEU20-PHE15","ASP22-GLU25","LYS23-GLU44","THR24-ASP22","GLU25-ASP22","ARG26-GLU30","LEU28-GLU25","GLU30-ARG26","SER31-LEU28","TYR32-LYS248","SER41-VAL198","MET47-GLU44","SER48-THR175","GLN51-SER48","MET53-ARG98","LEU54-CYS64","LYS57-ASP94","LYS57-ASN93","GLN60-LYS57","ALA66-VAL52","ARG72-ASP71","ARG72-LEU141","ARG72-GLU118","THR76-ALA137","ALA77-THR76","ALA78-ASP135","LEU81-ALA78","LEU82-ALA78","TYR83-LYS88","ASP87-PRO84","PHE90-LEU81","THR91-ASP94","GLU92-GLU92","ASP94-THR91","ARG98-MET53","ILE99-LYS113","ILE111-GLU108","ILE111-ARG109","GLU112-GLU108","LYS119-GLU92","TYR126-LEU82","ASN127-ASP133","ASP133-ASN127","LYS140-PHE293","LYS140-GLU118","VAL145-ASP71","SER148-ILE151","ARG159-GLU160","THR161-ASP158","ALA162-ASP158","SER164-GLU160","LEU165-THR161","LEU166-ALA162","GLN167-LEU165","GLN167-SER164","GLY169-ILE203","TYR170-ASP34","LYS171-SER31","LYS171-GLU27","ARG173-ASP22","ARG173-THR24","VAL174-VAL199","GLY176-GLN197","TRP177-HIS102","ASN179-GLU238","LYS181-GLU39","LEU196-HIS102","GLN197-GLY176","GLN197-ASP42","GLN197-LEU196","ASN200-THR24","ASN200-GLU27","GLU205-GLU205","ARG206-ASP219","ARG206-MET221","ARG206-THR218","CYS209-GLU205","ASP211-PRO207","SER212-VAL208","SER212-CYS209","THR213-GLU265","THR218-ASP133","ALA224-GLY274","TYR226-ASN200","LYS227-GLU230","LYS227-GLU205","GLU230-LYS227","LYS232-GLU27","ARG233-ASP270","ALA236-ASP235","GLU238-CYS237","ASP240-CYS237","GLY243-ASP240","MET247-TYR256","LYS248-ASN253","LYS248-GLU16","LYS248-GLU25","ASN252-TYR256","ASN253-SER249","ARG254-ASN252","ARG254-ASP8","ARG254-CYS9","GLN257-GLY259","MET258-PHE245","GLY259-PHE245","VAL261-GLY243","SER262-PHE275","ASP268-ASP235","ARG269-GLU182","LYS272-GLU265","LYS272-SER212","GLY274-ALA224","PHE275-TRP263","THR277-ILE260","THR277-ASP135","VAL279-MET258","LEU282-VAL279")
Colnames2 <- c("LYS283-GLN287","LYS283-PRO157","ILE286-LEU282","GLN287-LYS283","VAL289-TRP285","ASP291-GLN287","GLN292-LYS288","PHE293-VAL289","GLY294-ILE290","ILE37-ASN179","TRP50-SER48","ARG56-SER58","ILE69-TRP73","SER70-TRP73","ASP71-SER70","ASP71-ASP71","ARG72-GLU295","ARG72-LYS142","LYS88-TYR83","VAL97-SER115","HIS123-ILE136","ASN131-ARG216","TYR150-SER148","ILE151-SER148","VAL154-LEU68","GLU160-GLU160","ALA163-ARG159","VAL199-VAL174","LYS210-ARG206","LYS210-ASP219","ARG216-GLU130","ASN220-THR218","ASP229-ASP229","ASP235-VAL38","SER241-HIS79","TRP255-GLU16","CYS267-GLU182","LYS288-LYS284","ILE290-ILE286","LEU11-HIS152","PHE15-ARG12","TYR32-LYS171","SER48-MET47","GLN51-VAL52","TRP73-SER70","SER115-MET116","TYR126-HIS123","ILE136-ARG134","LYS140-GLU295","HIS152-PRO49","CYS155-TRP255","GLN167-ALA163","ARG173-ASN200","GLN197-VAL195","LYS210-ILE217","ARG281-HIS278","TRP285-LEU282","LEU29-GLU25","THR105-SER194","MET221-THR218","GLY239-SER241","PHE251-SER249","ASN252-SER249","ILE260-THR277","GLU16-ARG12","LYS17-PRO13","LYS18-LEU14","LEU28-THR24","TYR32-LEU29","ARG129-ASN127","TYR170-GLN167","GLN192-ASN179","SER194-SER103","VAL208-GLU205","LYS272-ARG269","SER58-GLN60","ARG106-SER103","LYS283-VAL279","LYS283-LEU156","LYS119-GLU118","SER19-PHE15","SER194-THR105","SER241-SER262","GLY234-ASP268","ARG72-GLY294","ASN187-THR185","THR218-ASN131","ARG109-TYR107","LYS142-GLU118","LEU180-GLN192","LYS288-ASP291","GLU61-PRO59","PHE2-THR1","CYS9-ASP8","MET258-TYR256","TRP86-TYR83","LYS88-TRP86","ARG159-ASP158","TYR32-LEU28","LYS283-ASP158","ILE33-LEU29","ARG36-GLY35","ASP158-THR161","LEU165-ALA162","ILE217-ILE215","GLY243-SER241","ARG36-ASP34","ARG104-TRP177","TRP128-ASN127","THR183-GLU238","VAL195-SER194","ARG26-GLU21","SER31-GLU27","ARG214-GLU265","LYS248-TYR32","ASN220-HIS278","ILE215-THR213","ILE120-GLU92","GLU61-ARG56","HIS152-ILE151","ARG206-ILE217","LEU62-GLU61","CYS64-LEU54","ARG104-GLU61","ASN131-ARG129","HIS152-SER148","THR1-GLU6","GLN257-GLN257","TRP263-SER262","ARG36-GLU30","LYS227-ASP229","ARG26-ASP22","ARG56-LYS57","ARG56-PRO59","LYS17-ASP149","HIS278-MET258","ARG216-ASP211","ARG281-ASP219","ASP219-ASP219","LEU132-ASN131","LYS23-GLU21","THR218-LEU132","SER212-GLY271","LYS232-GLU39","TYR273-SER212","GLY46-HIS102","GLY35-GLU30","ASP34-GLU30","GLU27-LYS23","ARG173-GLU25","THR1-ASP71","ARG233-GLU39","LEU132-ARG216","HIS123-PRO124")
Colnames <- c(Colnames1,Colnames2)
colnames(hbond_stride100_trajectory) <- Colnames 
```

```{r}
# Add column TM4
a=rep(0, 8000)
b=rep(1, 8000)
d <- c(a,b)
hbond_stride100_trajectory$TM4 <- d
levels(as.factor(hbond_stride100_trajectory$TM4))
```

```{r}
# Train the logistic regression model
m2 <- glm(formula = TM4 ~ ., data=hbond_stride100_trajectory, family='binomial')
```

```{r}
# Save coef
coef <- data.frame(m2$coefficients)
write.csv(coef, "/deac/salsburyGrp/wud18/md/TM/logistic_regression_Hbond/thrombin_TM456.csv", row.names = TRUE)
```

```{r}
# Coef in order
coef_sorted <- sort(m2$coefficients, decreasing = TRUE)
knitr::kable(c(coef_sorted[1:10],coef_sorted[270:279]))
```

```{r}
alpha_list <- seq(from =0, to = 1, by =.0625)
EN <- function(Lambda) {
tuningGrid <- data.frame("alpha" = alpha_list, "lambda"= rep(Lambda, length(alpha_list)))
set.seed(100)
hbond_elnet = train(
  as.factor(TM4) ~ ., data = hbond_stride100_trajectory,
  method = "glmnet",
  lambda=Lambda,
  tuneGrid = tuningGrid,
  trControl = trainControl(method = "cv", number = 10)
)
return(hbond_elnet)
}
```

```{r}
lambda_list=seq(from =0, to = 0.005, by =.00015625)
EN_list=EN(lambda_list[1])$results$Accuracy
for (i in 2:length(lambda_list)){
  print(lambda_list[i])
  EN_list=data.frame(EN_list, EN(lambda_list[i])$results$Accuracy)
}
```

```{r}
# Row and column names
rownames(EN_list) <- alpha_list
colnames(EN_list) <- lambda_list
```

```{r}
# Save csv
write.csv(EN_list, "/deac/salsburyGrp/wud18/md/TM/logistic_regression_Hbond/thrombin_TM456.csv", row.names=TRUE)
```

















